<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>VibeTrip ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      color: #fff;
      min-height: 100vh;
      padding: 20px;
    }
    .container { max-width: 1400px; margin: 0 auto; }
    
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding: 20px 24px;
      background: rgba(255,255,255,0.05);
      border-radius: 16px;
      backdrop-filter: blur(10px);
    }
    .logo { display: flex; align-items: center; gap: 12px; }
    .logo h1 { font-size: 24px; font-weight: 700; }
    .logo span { color: #a78bfa; }
    .status-badge {
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 500;
    }
    .status-ok { background: rgba(34, 197, 94, 0.2); color: #22c55e; }
    .status-warn { background: rgba(245, 158, 11, 0.2); color: #f59e0b; }
    .status-error { background: rgba(239, 68, 68, 0.2); color: #ef4444; }
    
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .card {
      background: rgba(255,255,255,0.05);
      border-radius: 16px;
      padding: 24px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.1);
    }
    .card h2 {
      font-size: 16px;
      color: #a78bfa;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .card h2::before {
      content: '';
      width: 8px;
      height: 8px;
      background: #a78bfa;
      border-radius: 50%;
    }
    
    .stat-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 16px;
    }
    .stat-item {
      text-align: center;
      padding: 16px;
      background: rgba(255,255,255,0.03);
      border-radius: 12px;
    }
    .stat-value {
      font-size: 32px;
      font-weight: 700;
      color: #fff;
    }
    .stat-label {
      font-size: 12px;
      color: #9ca3af;
      margin-top: 4px;
    }
    
    .service-list { display: flex; flex-direction: column; gap: 12px; }
    .service-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 16px;
      background: rgba(255,255,255,0.03);
      border-radius: 10px;
    }
    .service-name { font-size: 14px; }
    .service-status {
      width: 10px;
      height: 10px;
      border-radius: 50%;
    }
    .service-status.active { background: #22c55e; box-shadow: 0 0 8px #22c55e; }
    .service-status.inactive { background: #ef4444; }
    .service-status.pending { background: #f59e0b; }
    .service-status.unconfigured { background: #6b7280; }
    
    .freshness-bar {
      display: flex;
      height: 24px;
      border-radius: 12px;
      overflow: hidden;
      margin-bottom: 16px;
    }
    .freshness-segment { transition: width 0.3s ease; }
    .freshness-legend {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      font-size: 12px;
    }
    .legend-item {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .legend-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
    }
    
    .channel-list { display: flex; flex-direction: column; gap: 10px; max-height: 300px; overflow-y: auto; }
    .channel-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 14px;
      background: rgba(255,255,255,0.03);
      border-radius: 8px;
    }
    .channel-info { display: flex; align-items: center; gap: 10px; }
    .channel-thumb {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: rgba(255,255,255,0.2);
      border: 2px solid rgba(255,255,255,0.1);
    }
    .channel-thumb.sync-active {
      background: #10b981;
      border-color: rgba(16,185,129,0.3);
      box-shadow: 0 0 8px rgba(16,185,129,0.5);
    }
    .channel-thumb.sync-stale {
      background: #f59e0b;
      border-color: rgba(245,158,11,0.3);
      box-shadow: 0 0 8px rgba(245,158,11,0.5);
    }
    .channel-thumb.sync-none {
      background: rgba(107,114,128,0.5);
      border-color: rgba(107,114,128,0.3);
    }
    .channel-name { font-size: 14px; }
    .channel-category {
      font-size: 11px;
      color: #9ca3af;
      background: rgba(255,255,255,0.05);
      padding: 2px 8px;
      border-radius: 4px;
    }
    .trust-weight {
      font-size: 12px;
      padding: 4px 10px;
      background: linear-gradient(135deg, #6366f1, #a78bfa);
      border-radius: 12px;
    }
    
    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }
    .btn-primary {
      background: linear-gradient(135deg, #6366f1, #a78bfa);
      color: #fff;
    }
    .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3); }
    .btn-secondary {
      background: rgba(255,255,255,0.1);
      color: #fff;
    }
    .btn-sm { padding: 6px 12px; font-size: 12px; }
    
    .add-form {
      display: none;
      padding: 16px;
      background: rgba(255,255,255,0.03);
      border-radius: 12px;
      margin-bottom: 16px;
    }
    .add-form.active { display: block; }
    .add-form input, .add-form select {
      width: 100%;
      padding: 10px 14px;
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 8px;
      background: rgba(255,255,255,0.05);
      color: #fff;
      margin-bottom: 10px;
      font-size: 14px;
    }
    .add-form input::placeholder { color: #6b7280; }
    
    .sync-logs { max-height: 200px; overflow-y: auto; }
    .log-item {
      display: flex;
      justify-content: space-between;
      padding: 8px 12px;
      border-bottom: 1px solid rgba(255,255,255,0.05);
      font-size: 13px;
    }
    .log-time { color: #6b7280; }
    .log-status { padding: 2px 8px; border-radius: 4px; font-size: 11px; }
    .log-status.success { background: rgba(34, 197, 94, 0.2); color: #22c55e; }
    .log-status.error { background: rgba(239, 68, 68, 0.2); color: #ef4444; }
    .log-status.pending { background: rgba(245, 158, 11, 0.2); color: #f59e0b; }
    
    .empty-state {
      text-align: center;
      padding: 40px;
      color: #6b7280;
    }
    
    .tabs {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 20px;
    }
    .tab {
      padding: 8px 12px;
      background: rgba(255,255,255,0.05);
      border: none;
      border-radius: 8px;
      color: #9ca3af;
      cursor: pointer;
      font-size: 13px;
      transition: all 0.2s;
      white-space: nowrap;
    }
    .tab.active {
      background: linear-gradient(135deg, #6366f1, #a78bfa);
      color: #fff;
    }
    
    .loading { text-align: center; padding: 40px; color: #6b7280; }
    .spinner {
      width: 32px;
      height: 32px;
      border: 3px solid rgba(255,255,255,0.1);
      border-top-color: #a78bfa;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 16px;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    
    /* ğŸ“± ë°˜ì‘í˜• ìŠ¤íƒ€ì¼ */
    @media (max-width: 768px) {
      body { padding: 10px; }
      .container { max-width: 100%; }
      
      header {
        flex-direction: column;
        gap: 12px;
        padding: 16px;
        text-align: center;
      }
      .logo h1 { font-size: 20px; }
      
      .tabs {
        justify-content: center;
        gap: 6px;
      }
      .tab {
        padding: 6px 10px;
        font-size: 11px;
      }
      
      .grid {
        grid-template-columns: 1fr;
        gap: 12px;
      }
      
      .card {
        padding: 16px;
      }
      .card h2 {
        font-size: 14px;
      }
      
      .stat-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 8px;
      }
      .stat-value {
        font-size: 24px;
      }
      .stat-label {
        font-size: 10px;
      }
      
      .btn {
        padding: 8px 12px;
        font-size: 12px;
      }
      
      .service-item {
        flex-direction: column;
        gap: 8px;
        text-align: center;
      }
      
      .form-input, select {
        width: 100%;
        min-width: unset !important;
      }
    }
    
    @media (max-width: 480px) {
      .tabs {
        flex-direction: column;
        align-items: stretch;
      }
      .tab {
        text-align: center;
        padding: 10px;
      }
      
      .stat-grid {
        grid-template-columns: 1fr 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="logo">
        <h1>Vibe<span>Trip</span></h1>
        <span style="color: #6b7280; font-size: 14px;">ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</span>
      </div>
      <div style="display: flex; align-items: center; gap: 16px;">
        <span id="last-update" style="font-size: 12px; color: #6b7280;"></span>
        <div id="system-status" class="status-badge status-ok">ì‹œìŠ¤í…œ ì •ìƒ</div>
      </div>
    </header>
    
    <div class="tabs">
      <button class="tab active" data-tab="overview">í˜„í™©</button>
      <button class="tab" data-tab="sources">ë°ì´í„° ì†ŒìŠ¤</button>
      <button class="tab" data-tab="api">API ìƒíƒœ</button>
      <button class="tab" data-tab="logs">ë™ê¸°í™” ë¡œê·¸</button>
      <button class="tab" data-tab="guide-prices">ê°€ì´ë“œ ê°€ê²©</button>
      <button class="tab" data-tab="crisis-alerts">ğŸš¨ ìœ„ê¸° ì •ë³´</button>
      <button class="tab" data-tab="verifications">ê²€ì¦ ìš”ì²­</button>
    </div>
    
    <div id="tab-overview" class="tab-content">
      <!-- ğŸ¯ ì‹¤ì‹œê°„ ê´€ì œíƒ‘ ìš”ì•½ ì¹´ë“œ -->
      <div id="control-tower-summary" class="card" style="margin-bottom: 20px; background: linear-gradient(135deg, rgba(99,102,241,0.15), rgba(167,139,250,0.1)); border: 1px solid rgba(167,139,250,0.3);">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
          <h2 style="color: #a78bfa; margin: 0;">ğŸ¯ ì‹¤ì‹œê°„ ê´€ì œíƒ‘</h2>
          <span id="control-tower-time" style="font-size: 12px; color: #6b7280;">ì—…ë°ì´íŠ¸: -</span>
        </div>
        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px;">
          <div style="text-align: center; padding: 16px; background: rgba(255,255,255,0.03); border-radius: 12px;">
            <div id="ct-syncs-today" style="font-size: 28px; font-weight: 700; color: #22c55e;">-</div>
            <div style="font-size: 12px; color: #9ca3af;">ì˜¤ëŠ˜ ë™ê¸°í™”</div>
          </div>
          <div style="text-align: center; padding: 16px; background: rgba(255,255,255,0.03); border-radius: 12px;">
            <div id="ct-success-rate" style="font-size: 28px; font-weight: 700; color: #3b82f6;">-</div>
            <div style="font-size: 12px; color: #9ca3af;">ì„±ê³µë¥ </div>
          </div>
          <div style="text-align: center; padding: 16px; background: rgba(255,255,255,0.03); border-radius: 12px;">
            <div id="ct-api-status" style="font-size: 28px; font-weight: 700; color: #f59e0b;">-</div>
            <div style="font-size: 12px; color: #9ca3af;">API ì—°ê²°</div>
          </div>
          <div style="text-align: center; padding: 16px; background: rgba(255,255,255,0.03); border-radius: 12px;">
            <div id="ct-cache-total" style="font-size: 28px; font-weight: 700; color: #a78bfa;">-</div>
            <div style="font-size: 12px; color: #9ca3af;">ìºì‹œ ë°ì´í„°</div>
          </div>
        </div>
      </div>

      <div id="alerts-container" style="margin-bottom: 20px; display: none;">
        <div class="card" style="border: 1px solid rgba(245, 158, 11, 0.3); background: rgba(245, 158, 11, 0.05);">
          <h2 style="color: #f59e0b;">í’ˆì§ˆ ì•Œë¦¼</h2>
          <div id="quality-alerts" style="display: flex; flex-direction: column; gap: 8px;"></div>
        </div>
      </div>
      
      <div class="grid">
        <div class="card">
          <h2>ë°ì´í„° í˜„í™©</h2>
          <div class="stat-grid">
            <div class="stat-item">
              <div class="stat-value" id="stat-cities">-</div>
              <div class="stat-label">ë„ì‹œ</div>
            </div>
            <div class="stat-item">
              <div class="stat-value" id="stat-places">-</div>
              <div class="stat-label">ì¥ì†Œ</div>
            </div>
            <div class="stat-item">
              <div class="stat-value" id="stat-channels">-</div>
              <div class="stat-label">ìœ íŠœë¸Œ ì±„ë„</div>
            </div>
            <div class="stat-item">
              <div class="stat-value" id="stat-blogs">-</div>
              <div class="stat-label">ë¸”ë¡œê·¸ ì†ŒìŠ¤</div>
            </div>
          </div>
        </div>
        
        <div class="card">
          <h2>ìˆ˜ì§‘ í†µê³„</h2>
          <div class="stat-grid">
            <div class="stat-item">
              <div class="stat-value" id="stat-videos" style="color: #ff0000;">-</div>
              <div class="stat-label">YouTube ì˜ìƒ</div>
            </div>
            <div class="stat-item">
              <div class="stat-value" id="stat-blog-posts" style="color: #03c75a;">-</div>
              <div class="stat-label">ë¸”ë¡œê·¸ í¬ìŠ¤íŠ¸</div>
            </div>
            <div class="stat-item">
              <div class="stat-value" id="stat-place-mentions" style="color: #a78bfa;">-</div>
              <div class="stat-label">ì¥ì†Œ ì–¸ê¸‰</div>
            </div>
            <div class="stat-item">
              <div class="stat-value" id="stat-syncs-today" style="color: #22c55e;">-</div>
              <div class="stat-label">ì˜¤ëŠ˜ ë™ê¸°í™”</div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="grid">
        <div class="card">
          <h2>ë°ì´í„° ì‹ ì„ ë„</h2>
          <div id="freshness-bar" class="freshness-bar"></div>
          <div id="freshness-legend" class="freshness-legend"></div>
        </div>
        
        <div class="card">
          <h2>ì£¼ê°„ ë™ê¸°í™” ì¶”ì´</h2>
          <div id="weekly-chart" style="display: flex; align-items: flex-end; justify-content: space-around; height: 100px; gap: 8px;"></div>
          <div id="weekly-labels" style="display: flex; justify-content: space-around; font-size: 11px; color: #6b7280; margin-top: 8px;"></div>
        </div>
      </div>
      
      <div class="grid">
        <div class="card">
          <h2>API ì„œë¹„ìŠ¤</h2>
          <div id="api-services" class="service-list">
            <div class="loading"><div class="spinner"></div>ë¡œë”© ì¤‘...</div>
          </div>
        </div>
        
        <div class="card">
          <h2>ìµœê·¼ ë™ê¸°í™”</h2>
          <div id="recent-syncs" class="sync-logs">
            <div class="loading"><div class="spinner"></div>ë¡œë”© ì¤‘...</div>
          </div>
        </div>
      </div>

      <!-- ğŸ¯ ìŠ¤ì¼€ì¤„ëŸ¬ ì‹¤ì‹œê°„ í˜„í™© -->
      <div class="card" style="margin-top: 20px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
          <h2 style="margin: 0;">â° ìŠ¤ì¼€ì¤„ëŸ¬ í˜„í™©</h2>
          <span id="scheduler-status" class="status-badge status-ok">ì‹¤í–‰ ì¤‘</span>
        </div>
        <div id="scheduler-tasks" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 12px;">
          <div class="loading"><div class="spinner"></div>ë¡œë”© ì¤‘...</div>
        </div>
      </div>

      <!-- ğŸ¯ ì¶”ê°€ ë°ì´í„° ìˆ˜ì§‘ê¸° í˜„í™© -->
      <div class="grid" style="margin-top: 20px;">
        <div class="card">
          <h2>ğŸ“Š ì¼ì • ìƒì„± í†µê³„</h2>
          <div id="itinerary-stats" style="display: flex; flex-direction: column; gap: 12px;">
            <div style="display: flex; justify-content: space-around;">
              <div style="text-align: center;">
                <div id="itinerary-today" style="font-size: 28px; font-weight: 700; color: #22c55e;">-</div>
                <div style="font-size: 12px; color: #9ca3af;">ì˜¤ëŠ˜</div>
              </div>
              <div style="text-align: center;">
                <div id="itinerary-week" style="font-size: 28px; font-weight: 700; color: #3b82f6;">-</div>
                <div style="font-size: 12px; color: #9ca3af;">ì´ë²ˆ ì£¼</div>
              </div>
              <div style="text-align: center;">
                <div id="itinerary-total" style="font-size: 28px; font-weight: 700; color: #a78bfa;">-</div>
                <div style="font-size: 12px; color: #9ca3af;">ì „ì²´</div>
              </div>
            </div>
            <div id="itinerary-top-cities" style="font-size: 12px; color: #6b7280; text-align: center;"></div>
          </div>
        </div>

        <div class="card">
          <h2>ğŸ›£ï¸ ê²½ë¡œ ìºì‹œ í˜„í™©</h2>
          <div id="route-cache-stats" style="display: flex; flex-direction: column; gap: 12px;">
            <div style="display: flex; justify-content: space-around;">
              <div style="text-align: center;">
                <div id="route-total" style="font-size: 28px; font-weight: 700; color: #22c55e;">-</div>
                <div style="font-size: 12px; color: #9ca3af;">ì „ì²´ ê²½ë¡œ</div>
              </div>
              <div style="text-align: center;">
                <div id="route-week" style="font-size: 28px; font-weight: 700; color: #3b82f6;">-</div>
                <div style="font-size: 12px; color: #9ca3af;">ìµœê·¼ 7ì¼</div>
              </div>
            </div>
            <div id="route-by-mode" style="display: flex; justify-content: center; gap: 16px; flex-wrap: wrap;"></div>
          </div>
        </div>

        <div class="card">
          <h2>ğŸ”¥ í˜¼ì¡ë„ ë¶„ì„</h2>
          <div style="display: flex; flex-direction: column; gap: 12px;">
            <div style="display: flex; justify-content: space-around;">
              <div style="text-align: center;">
                <div id="popularity-total" style="font-size: 28px; font-weight: 700; color: #f59e0b;">-</div>
                <div style="font-size: 12px; color: #9ca3af;">ìºì‹œëœ ì¥ì†Œ</div>
              </div>
              <div style="text-align: center;">
                <div id="popularity-24h" style="font-size: 28px; font-weight: 700; color: #22c55e;">-</div>
                <div style="font-size: 12px; color: #9ca3af;">ìµœê·¼ 24ì‹œê°„</div>
              </div>
            </div>
            <div style="text-align: center; font-size: 12px; color: #6b7280;">
              í˜¼ì¡ë„ ì •ë³´ëŠ” Gemini AI + íœ´ë¦¬ìŠ¤í‹±ìœ¼ë¡œ ì¶”ì •
            </div>
          </div>
        </div>
      </div>

      <!-- ğŸ‡°ğŸ‡· í•œêµ­ ê°ì„± ë°ì´í„° ì†ŒìŠ¤ í˜„í™© (Vibe ì¶”ì²œ í•µì‹¬) -->
      <div class="card" style="margin-top: 20px; background: linear-gradient(135deg, rgba(225,48,108,0.1), rgba(99,102,241,0.1)); border: 1px solid rgba(225,48,108,0.3);">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
          <h2 style="color: #e1306c; margin: 0;">ğŸ‡°ğŸ‡· í•œêµ­ ê°ì„± ë°ì´í„° (Vibe ì¶”ì²œ ì†ŒìŠ¤)</h2>
          <span style="font-size: 11px; color: #6b7280;">ëˆ„êµ¬ë‘ â†’ <span style="color: #e1306c; font-weight: 600;">ì·¨í–¥ ì„ íƒ</span> ì‹œ í™œìš©</span>
        </div>
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px;">
          <!-- Instagram -->
          <div style="padding: 20px; background: rgba(225,48,108,0.1); border-radius: 12px; border: 1px solid rgba(225,48,108,0.2);">
            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px;">
              <span style="font-size: 20px;">ğŸ“¸</span>
              <span style="font-weight: 600; color: #e1306c;">Instagram</span>
              <span style="font-size: 11px; background: rgba(225,48,108,0.2); color: #e1306c; padding: 2px 8px; border-radius: 10px; margin-left: auto;">ìš°ì„ ìˆœìœ„ 1</span>
            </div>
            <div style="display: flex; justify-content: space-around; margin-bottom: 12px;">
              <div style="text-align: center;">
                <div id="kr-insta-hashtags" style="font-size: 24px; font-weight: 700; color: #e1306c;">-</div>
                <div style="font-size: 11px; color: #9ca3af;">í•´ì‹œíƒœê·¸</div>
              </div>
              <div style="text-align: center;">
                <div id="kr-insta-posts" style="font-size: 24px; font-weight: 700; color: #e1306c;">-</div>
                <div style="font-size: 11px; color: #9ca3af;">ì´ ê²Œì‹œë¬¼</div>
              </div>
              <div style="text-align: center;">
                <div id="kr-insta-photos" style="font-size: 24px; font-weight: 700; color: #e1306c;">-</div>
                <div style="font-size: 11px; color: #9ca3af;">ìˆ˜ì§‘ ì‚¬ì§„</div>
              </div>
            </div>
            <div style="display: flex; justify-content: space-between; align-items: center;">
              <span id="kr-insta-sync" style="font-size: 11px; color: #6b7280;">ë§ˆì§€ë§‰ ë™ê¸°í™”: -</span>
              <button class="btn btn-sm" style="background: rgba(225,48,108,0.2); color: #e1306c; border: 1px solid rgba(225,48,108,0.3);" onclick="syncKoreanInstagram()">ë™ê¸°í™”</button>
            </div>
          </div>

          <!-- Naver Blog -->
          <div style="padding: 20px; background: rgba(3,199,90,0.1); border-radius: 12px; border: 1px solid rgba(3,199,90,0.2);">
            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px;">
              <span style="font-size: 20px;">ğŸ“</span>
              <span style="font-weight: 600; color: #03c75a;">ë„¤ì´ë²„ ë¸”ë¡œê·¸</span>
              <span style="font-size: 11px; background: rgba(3,199,90,0.2); color: #03c75a; padding: 2px 8px; border-radius: 10px; margin-left: auto;">ìš°ì„ ìˆœìœ„ 2</span>
            </div>
            <div style="display: flex; justify-content: space-around; margin-bottom: 12px;">
              <div style="text-align: center;">
                <div id="kr-naver-posts" style="font-size: 24px; font-weight: 700; color: #03c75a;">-</div>
                <div style="font-size: 11px; color: #9ca3af;">ë¸”ë¡œê·¸ í¬ìŠ¤íŠ¸</div>
              </div>
              <div style="text-align: center;">
                <div id="kr-naver-places" style="font-size: 24px; font-weight: 700; color: #03c75a;">-</div>
                <div style="font-size: 11px; color: #9ca3af;">ì¥ì†Œ ì—°ê²°</div>
              </div>
              <div style="text-align: center;">
                <div id="kr-naver-sentiment" style="font-size: 24px; font-weight: 700; color: #03c75a;">-</div>
                <div style="font-size: 11px; color: #9ca3af;">ê¸ì • ë¹„ìœ¨</div>
              </div>
            </div>
            <div style="display: flex; justify-content: space-between; align-items: center;">
              <span id="kr-naver-sync" style="font-size: 11px; color: #6b7280;">ë§ˆì§€ë§‰ ë™ê¸°í™”: -</span>
              <button class="btn btn-sm" style="background: rgba(3,199,90,0.2); color: #03c75a; border: 1px solid rgba(3,199,90,0.3);" onclick="syncKoreanNaverBlog()">ë™ê¸°í™”</button>
            </div>
          </div>

          <!-- YouTube -->
          <div style="padding: 20px; background: rgba(255,0,0,0.1); border-radius: 12px; border: 1px solid rgba(255,0,0,0.2);">
            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px;">
              <span style="font-size: 20px;">ğŸ¬</span>
              <span style="font-weight: 600; color: #ff0000;">YouTube</span>
              <span style="font-size: 11px; background: rgba(255,0,0,0.2); color: #ff0000; padding: 2px 8px; border-radius: 10px; margin-left: auto;">ìš°ì„ ìˆœìœ„ 3</span>
            </div>
            <div style="display: flex; justify-content: space-around; margin-bottom: 12px;">
              <div style="text-align: center;">
                <div id="kr-youtube-channels" style="font-size: 24px; font-weight: 700; color: #ff0000;">-</div>
                <div style="font-size: 11px; color: #9ca3af;">ì±„ë„</div>
              </div>
              <div style="text-align: center;">
                <div id="kr-youtube-videos" style="font-size: 24px; font-weight: 700; color: #ff0000;">-</div>
                <div style="font-size: 11px; color: #9ca3af;">ì˜ìƒ</div>
              </div>
              <div style="text-align: center;">
                <div id="kr-youtube-mentions" style="font-size: 24px; font-weight: 700; color: #ff0000;">-</div>
                <div style="font-size: 11px; color: #9ca3af;">ì¥ì†Œ ì–¸ê¸‰</div>
              </div>
            </div>
            <div style="display: flex; justify-content: space-between; align-items: center;">
              <span id="kr-youtube-sync" style="font-size: 11px; color: #6b7280;">ë§ˆì§€ë§‰ ë™ê¸°í™”: -</span>
              <button class="btn btn-sm" style="background: rgba(255,0,0,0.2); color: #ff0000; border: 1px solid rgba(255,0,0,0.3);" onclick="syncKoreanYouTube()">ë™ê¸°í™”</button>
            </div>
          </div>
        </div>
        <!-- ìœ ëŸ½ 30ê°œ ë„ì‹œ ìºì‹œ ìƒíƒœ ë° ì „ì²´ ë™ê¸°í™” -->
        <div style="margin-top: 16px; padding: 16px; background: linear-gradient(135deg, rgba(99,102,241,0.1), rgba(139,92,246,0.1)); border-radius: 12px; border: 1px solid rgba(99,102,241,0.3);">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
            <div style="display: flex; align-items: center; gap: 8px;">
              <span style="font-size: 18px;">ğŸ‡ªğŸ‡º</span>
              <span style="font-weight: 600; color: #a78bfa;">ìœ ëŸ½ 30ê°œ ëŒ€í‘œ ë„ì‹œ ê°ì„± ë°ì´í„°</span>
            </div>
            <button class="btn btn-sm" style="background: linear-gradient(135deg, #6366f1, #8b5cf6); color: white; border: none; padding: 8px 16px; font-weight: 600;" onclick="syncAllKoreanSentiment()">ğŸ”„ ì „ì²´ ë™ê¸°í™”</button>
          </div>
          <div style="display: flex; justify-content: space-around; text-align: center;">
            <div>
              <div id="cache-total" style="font-size: 24px; font-weight: 700; color: #a78bfa;">-</div>
              <div style="font-size: 11px; color: #9ca3af;">ìºì‹œëœ ë„ì‹œ</div>
            </div>
            <div>
              <div id="cache-valid" style="font-size: 24px; font-weight: 700; color: #10b981;">-</div>
              <div style="font-size: 11px; color: #9ca3af;">ìœ íš¨ (7ì¼ ì´ë‚´)</div>
            </div>
            <div>
              <div id="cache-expired" style="font-size: 24px; font-weight: 700; color: #f59e0b;">-</div>
              <div style="font-size: 11px; color: #9ca3af;">ë§Œë£Œë¨</div>
            </div>
            <div>
              <div id="cache-coverage" style="font-size: 24px; font-weight: 700; color: #6366f1;">-</div>
              <div style="font-size: 11px; color: #9ca3af;">ì»¤ë²„ë¦¬ì§€</div>
            </div>
          </div>
        </div>
        <div style="margin-top: 12px; padding: 12px; background: rgba(255,255,255,0.03); border-radius: 8px; text-align: center;">
          <span style="font-size: 12px; color: #9ca3af;">ğŸ’¡ ì´ ë°ì´í„°ëŠ” ì‚¬ìš©ìê°€ <span style="color: #a78bfa; font-weight: 600;">ë¡œë§¨í‹±/í•«ìŠ¤íŒŸ/ë¯¸ì‹</span> ë“± ì·¨í–¥ì„ ì„ íƒí•  ë•Œ Gemini AIê°€ ì°¸ê³ í•˜ëŠ” <span style="color: #e1306c; font-weight: 600;">í•œêµ­ì¸ ê°ì„± ê°€ì¤‘ì¹˜</span> ì†ŒìŠ¤ì…ë‹ˆë‹¤.</span>
          <div style="margin-top: 8px; font-size: 11px; color: #6b7280;">
            íŒŒë¦¬, ë¡œë§ˆ, ë°”ë¥´ì…€ë¡œë‚˜, ëŸ°ë˜, í”„ë¼í•˜, ì•”ìŠ¤í…Œë¥´ë‹´, ë¹„ì—”ë‚˜, ë¶€ë‹¤í˜ìŠ¤íŠ¸, ë‘ë¸Œë¡œë¸Œë‹ˆí¬ ë“± ìœ ëŸ½ 30ê°œ ë„ì‹œ
          </div>
        </div>
      </div>
    </div>
    
    <div id="tab-sources" class="tab-content" style="display: none;">
      <div class="card" style="margin-bottom: 20px;">
        <h2>ë°ì´í„° ì†ŒìŠ¤ í†µí•© í˜„í™©</h2>
        <p style="font-size: 12px; color: #9ca3af; margin-bottom: 16px;">ëª¨ë“  ë°ì´í„° ì†ŒìŠ¤ì˜ ìˆ˜ì§‘ í˜„í™©ì„ í•œëˆˆì— í™•ì¸í•˜ì„¸ìš”. ìë™ ìˆ˜ì§‘: ë§¤ì¼ 3AM KST</p>
        <div id="unified-sources" style="display: grid; gap: 12px;">
          <div class="source-row" style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr 1fr; gap: 12px; padding: 12px 16px; background: rgba(255,255,255,0.03); border-radius: 10px; align-items: center;">
            <div style="font-weight: 600; color: #a78bfa;">ì†ŒìŠ¤</div>
            <div style="text-align: center; font-weight: 600; color: #a78bfa;">ìƒíƒœ</div>
            <div style="text-align: center; font-weight: 600; color: #a78bfa;">ìˆ˜ì§‘ëŸ‰</div>
            <div style="text-align: center; font-weight: 600; color: #a78bfa;">ë§ˆì§€ë§‰ ë™ê¸°í™”</div>
            <div style="text-align: center; font-weight: 600; color: #a78bfa;">ì•¡ì…˜</div>
          </div>
          <div id="source-google" class="source-row" style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr 1fr; gap: 12px; padding: 12px 16px; background: rgba(255,255,255,0.03); border-radius: 10px; align-items: center;">
            <div><span style="color: #4285f4;">â—</span> Google Places</div>
            <div style="text-align: center;"><span id="google-status" class="status-badge status-ok">í™œì„±</span></div>
            <div style="text-align: center;" id="google-count">- ì¥ì†Œ</div>
            <div style="text-align: center; font-size: 12px;" id="google-sync">-</div>
            <div style="text-align: center;"><button class="btn btn-sm btn-secondary" onclick="syncGooglePlaces()">ë™ê¸°í™”</button></div>
          </div>
          <div id="source-instagram" class="source-row" style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr 1fr; gap: 12px; padding: 12px 16px; background: rgba(255,255,255,0.03); border-radius: 10px; align-items: center;">
            <div><span style="color: #e1306c;">â—</span> Instagram</div>
            <div style="text-align: center;"><span id="instagram-status" class="status-badge status-ok">í™œì„±</span></div>
            <div style="text-align: center;" id="instagram-count">- í•´ì‹œíƒœê·¸</div>
            <div style="text-align: center; font-size: 12px;" id="instagram-sync">-</div>
            <div style="text-align: center;"><button class="btn btn-sm btn-secondary" onclick="syncAllInstagram()">ë™ê¸°í™”</button></div>
          </div>
          <div id="source-youtube" class="source-row" style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr 1fr; gap: 12px; padding: 12px 16px; background: rgba(255,255,255,0.03); border-radius: 10px; align-items: center;">
            <div><span style="color: #ff0000;">â—</span> YouTube</div>
            <div style="text-align: center;"><span id="youtube-status" class="status-badge status-warn">ëŒ€ê¸°</span></div>
            <div style="text-align: center;" id="youtube-count">- ì±„ë„<br><small id="youtube-videos" style="color: #9ca3af;">- ì˜ìƒ</small><br><small id="youtube-places" style="color: #22c55e;">- ì¥ì†Œ</small></div>
            <div style="text-align: center; font-size: 12px;" id="youtube-sync">-</div>
            <div style="text-align: center;"><button class="btn btn-sm btn-secondary" onclick="syncYouTube()">ë™ê¸°í™”</button></div>
          </div>
          <div id="source-naver" class="source-row" style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr 1fr; gap: 12px; padding: 12px 16px; background: rgba(255,255,255,0.03); border-radius: 10px; align-items: center;">
            <div><span style="color: #03c75a;">â—</span> ë„¤ì´ë²„ ë¸”ë¡œê·¸</div>
            <div style="text-align: center;"><span id="naver-status" class="status-badge status-warn">ëŒ€ê¸°</span></div>
            <div style="text-align: center;" id="naver-count">- ì†ŒìŠ¤</div>
            <div style="text-align: center; font-size: 12px;" id="naver-sync">-</div>
            <div style="text-align: center;"><button class="btn btn-sm btn-secondary" onclick="syncNaverBlogs()">ë™ê¸°í™”</button></div>
          </div>
          <div id="source-tistory" class="source-row" style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr 1fr; gap: 12px; padding: 12px 16px; background: rgba(255,255,255,0.03); border-radius: 10px; align-items: center;">
            <div><span style="color: #f97316;">â—</span> í‹°ìŠ¤í† ë¦¬ ë¸”ë¡œê·¸</div>
            <div style="text-align: center;"><span id="tistory-status" class="status-badge status-warn">ëŒ€ê¸°</span></div>
            <div style="text-align: center;" id="tistory-count">- í¬ìŠ¤íŠ¸</div>
            <div style="text-align: center; font-size: 12px;" id="tistory-sync">-</div>
            <div style="text-align: center;"><button class="btn btn-sm btn-secondary" onclick="syncTistory()">ë™ê¸°í™”</button></div>
          </div>
          <div id="source-popularity" class="source-row" style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr 1fr; gap: 12px; padding: 12px 16px; background: rgba(255,255,255,0.03); border-radius: 10px; align-items: center;">
            <div><span style="color: #f59e0b;">â—</span> í˜¼ì¡ë„ ë¶„ì„ (Gemini)</div>
            <div style="text-align: center;"><span id="popularity-status" class="status-badge status-warn">ëŒ€ê¸°</span></div>
            <div style="text-align: center;" id="popularity-count">- ì¥ì†Œ</div>
            <div style="text-align: center; font-size: 12px;" id="popularity-sync">ì‹¤ì‹œê°„</div>
            <div style="text-align: center;"><span style="font-size: 11px; color: #6b7280;">ìë™</span></div>
          </div>
          <div id="source-routes" class="source-row" style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr 1fr; gap: 12px; padding: 12px 16px; background: rgba(255,255,255,0.03); border-radius: 10px; align-items: center;">
            <div><span style="color: #3b82f6;">â—</span> ê²½ë¡œ/êµí†µë¹„ (Google Routes)</div>
            <div style="text-align: center;"><span id="routes-status" class="status-badge status-warn">ëŒ€ê¸°</span></div>
            <div style="text-align: center;" id="routes-count">- ê²½ë¡œ</div>
            <div style="text-align: center; font-size: 12px;" id="routes-sync">ì‹¤ì‹œê°„</div>
            <div style="text-align: center;"><span style="font-size: 11px; color: #6b7280;">ìë™</span></div>
          </div>
        </div>
      </div>
      
      <div class="grid">
        <div class="card">
          <h2>ìœ íŠœë¸Œ ì±„ë„</h2>
          <button class="btn btn-primary btn-sm" onclick="toggleForm('yt-form')" style="margin-bottom: 16px;">+ ì±„ë„ ì¶”ê°€</button>
          <div id="yt-form" class="add-form">
            <input type="text" id="yt-channel-id" placeholder="ì±„ë„ ID (ì˜ˆ: UC...)">
            <input type="text" id="yt-channel-name" placeholder="ì±„ë„ ì´ë¦„">
            <select id="yt-category">
              <option value="">ì¹´í…Œê³ ë¦¬ ì„ íƒ</option>
              <option value="food">ë§›ì§‘</option>
              <option value="travel">ì—¬í–‰</option>
              <option value="lifestyle">ë¼ì´í”„ìŠ¤íƒ€ì¼</option>
            </select>
            <input type="number" id="yt-trust" placeholder="ì‹ ë¢°ë„ ê°€ì¤‘ì¹˜ (0.1 - 2.0)" step="0.1" min="0.1" max="2">
            <button class="btn btn-primary" onclick="addYoutubeChannel()">ì¶”ê°€</button>
          </div>
          <div id="youtube-channels" class="channel-list">
            <div class="loading"><div class="spinner"></div>ë¡œë”© ì¤‘...</div>
          </div>
        </div>
        
        <div class="card">
          <h2>ë¸”ë¡œê·¸ ì†ŒìŠ¤</h2>
          <button class="btn btn-primary btn-sm" onclick="toggleForm('blog-form')" style="margin-bottom: 16px;">+ ì†ŒìŠ¤ ì¶”ê°€</button>
          <div id="blog-form" class="add-form">
            <select id="blog-platform">
              <option value="">í”Œë«í¼ ì„ íƒ</option>
              <option value="naver">ë„¤ì´ë²„ ë¸”ë¡œê·¸</option>
              <option value="tistory">í‹°ìŠ¤í† ë¦¬</option>
              <option value="michelin">ë¯¸ì‰ë¦° ê°€ì´ë“œ</option>
              <option value="tripadvisor">íŠ¸ë¦½ì–´ë“œë°”ì´ì €</option>
            </select>
            <input type="text" id="blog-name" placeholder="ì†ŒìŠ¤ ì´ë¦„">
            <input type="url" id="blog-url" placeholder="ì†ŒìŠ¤ URL">
            <input type="number" id="blog-trust" placeholder="ì‹ ë¢°ë„ ê°€ì¤‘ì¹˜ (0.1 - 2.0)" step="0.1" min="0.1" max="2">
            <button class="btn btn-primary" onclick="addBlogSource()">ì¶”ê°€</button>
          </div>
          <div id="blog-sources" class="channel-list">
            <div class="loading"><div class="spinner"></div>ë¡œë”© ì¤‘...</div>
          </div>
        </div>
      </div>
      
      <!-- Instagram ìˆ˜ë™ ê´€ë¦¬ ì„¹ì…˜ - Gemini ìë™í™”ë¡œ ëŒ€ì²´ë¨ (ìˆ¨ê¹€) -->
      <div class="card" style="margin-top: 20px; background: linear-gradient(135deg, rgba(225,48,108,0.1), rgba(99,102,241,0.1)); border: 1px solid rgba(225,48,108,0.2);">
        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
          <span style="font-size: 24px;">ğŸ“¸</span>
          <div>
            <h2 style="margin: 0; color: #e1306c;">Instagram ë°ì´í„° (ìë™í™”)</h2>
            <p style="margin: 4px 0 0; font-size: 12px; color: #9ca3af;">ìˆ˜ë™ ì¶”ê°€ ë¶ˆí•„ìš” - Gemini AIê°€ ì¼ì • ìƒì„± ì‹œ ìë™ ìˆ˜ì§‘</p>
          </div>
        </div>
        <div style="padding: 16px; background: rgba(0,0,0,0.2); border-radius: 8px;">
          <p style="color: #d1d5db; font-size: 14px; margin: 0 0 12px;">
            ğŸ‡ªğŸ‡º <strong style="color: #a78bfa;">ìœ ëŸ½ 30ê°œ ëŒ€í‘œ ë„ì‹œ</strong>ì˜ Instagram íŠ¸ë Œë“œ ë°ì´í„°ëŠ” 
            <strong style="color: #10b981;">Gemini AI Web Search</strong>ë¥¼ í†µí•´ ìë™ìœ¼ë¡œ ìˆ˜ì§‘ë©ë‹ˆë‹¤.
          </p>
          <ul style="color: #9ca3af; font-size: 13px; margin: 0; padding-left: 20px;">
            <li>ì¼ì • ìƒì„± ìš”ì²­ ì‹œ â†’ í•´ë‹¹ ë„ì‹œì˜ í•œêµ­ ê°ì„± ë°ì´í„° ìë™ ì¡°íšŒ</li>
            <li>ì¡°íšŒëœ ë°ì´í„°ëŠ” <strong style="color: #f59e0b;">7ì¼ê°„ ìºì‹œ</strong>ë˜ì–´ ì¬ì‚¬ìš©</li>
            <li>ìˆ˜ë™ ë™ê¸°í™”: ìœ„ì˜ "ğŸ”„ ì „ì²´ ë™ê¸°í™”" ë²„íŠ¼ ì‚¬ìš©</li>
          </ul>
        </div>
        <div style="margin-top: 12px; padding: 12px; background: rgba(16,185,129,0.1); border-radius: 8px; border: 1px solid rgba(16,185,129,0.2);">
          <span style="font-size: 12px; color: #10b981;">âœ… Meta API ì •ì±… ë³€ê²½ìœ¼ë¡œ ì§ì ‘ í¬ë¡¤ë§ ë¶ˆê°€ â†’ Gemini ê¸°ë°˜ ìë™í™”ë¡œ ëŒ€ì²´ë¨</span>
        </div>
      </div>
    </div>
    
    <div id="tab-api" class="tab-content" style="display: none;">
      <!-- API í‚¤ ê´€ë¦¬ ì„¹ì…˜ (ìƒˆë¡œ ì¶”ê°€) -->
      <div class="card" style="margin-bottom: 20px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
          <div>
            <h2 style="margin-bottom: 4px;">ğŸ”‘ API í‚¤ ê´€ë¦¬</h2>
            <p style="color: #9ca3af; font-size: 14px;">API í‚¤ë¥¼ ì…ë ¥í•˜ë©´ ì¦‰ì‹œ ë°˜ì˜ë©ë‹ˆë‹¤. ì„œë²„ ì¬ì‹œì‘ ì—†ì´ ë°”ë¡œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
          </div>
          <button class="btn btn-primary" onclick="openAddApiKeyModal()">+ ìƒˆ API í‚¤ ì¶”ê°€</button>
        </div>
        <div id="api-keys-list" style="display: flex; flex-direction: column; gap: 12px;">
          <div class="loading"><div class="spinner"></div>ë¡œë”© ì¤‘...</div>
        </div>
      </div>
      
      <!-- ìƒˆ API í‚¤ ì¶”ê°€ ëª¨ë‹¬ -->
      <div id="add-api-key-modal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); z-index: 1000; align-items: center; justify-content: center;">
        <div class="card" style="width: 90%; max-width: 500px; margin: auto;">
          <h2>ìƒˆ API í‚¤ ì¶”ê°€</h2>
          <form id="add-api-key-form" style="display: flex; flex-direction: column; gap: 16px;">
            <div>
              <label style="font-size: 12px; color: #9ca3af; display: block; margin-bottom: 4px;">í‚¤ ì´ë¦„ (ì˜ë¬¸, ëŒ€ë¬¸ì)</label>
              <input type="text" id="new-key-name" class="form-input" placeholder="ì˜ˆ: CUSTOM_API_KEY" required pattern="[A-Z_]+" style="text-transform: uppercase;">
            </div>
            <div>
              <label style="font-size: 12px; color: #9ca3af; display: block; margin-bottom: 4px;">í‘œì‹œ ì´ë¦„</label>
              <input type="text" id="new-key-display-name" class="form-input" placeholder="ì˜ˆ: Custom API" required>
            </div>
            <div>
              <label style="font-size: 12px; color: #9ca3af; display: block; margin-bottom: 4px;">ì„¤ëª… (ì„ íƒ)</label>
              <input type="text" id="new-key-description" class="form-input" placeholder="ì˜ˆ: ì–´ë””ì„œ ë°œê¸‰ë°›ëŠ”ì§€ ë“±">
            </div>
            <div>
              <label style="font-size: 12px; color: #9ca3af; display: block; margin-bottom: 4px;">API í‚¤ ê°’</label>
              <input type="password" id="new-key-value" class="form-input" placeholder="API í‚¤ ì…ë ¥" required>
            </div>
            <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 8px;">
              <button type="button" class="btn btn-secondary" onclick="closeAddApiKeyModal()">ì·¨ì†Œ</button>
              <button type="submit" class="btn btn-primary">ì¶”ê°€</button>
            </div>
          </form>
        </div>
      </div>
      
      <div class="card">
        <h2>API ì„¤ì • ìƒíƒœ</h2>
        <div style="margin-bottom: 20px; display: flex; gap: 12px; flex-wrap: wrap;">
          <button class="btn btn-primary" onclick="initApiServices()">ì„œë¹„ìŠ¤ ì´ˆê¸°í™”</button>
          <button class="btn btn-secondary" onclick="seedDefaultData()">ê¸°ë³¸ ë°ì´í„° ì…ë ¥</button>
          <button class="btn btn-secondary" onclick="seedCities()">ê¸°ë³¸ ë„ì‹œ ì…ë ¥</button>
          <button class="btn btn-secondary" onclick="seedInstagramHashtags()">ê¸°ë³¸ í•´ì‹œíƒœê·¸ ì…ë ¥</button>
        </div>
        <div id="api-detail" class="service-list">
          <div class="loading"><div class="spinner"></div>ë¡œë”© ì¤‘...</div>
        </div>
      </div>
      
      <div class="card" style="margin-top: 20px;">
        <h2>ë°ì´í„° ìˆ˜ì§‘</h2>
        <div id="api-real-status" style="margin-bottom: 16px; font-size: 14px; color: #9ca3af;"></div>
        <div style="display: flex; gap: 12px; flex-wrap: wrap;">
          <button class="btn btn-primary" onclick="syncExchangeRates()">í™˜ìœ¨ ë™ê¸°í™”</button>
          <button class="btn btn-secondary" onclick="syncYouTube()">ìœ íŠœë¸Œ ë™ê¸°í™”</button>
          <button class="btn btn-secondary" onclick="syncPlaces()">ì¥ì†Œ ë™ê¸°í™” (ì„œìš¸)</button>
        </div>
        <div id="sync-result" style="margin-top: 16px; font-size: 14px;"></div>
      </div>
    </div>
    
    <div id="tab-logs" class="tab-content" style="display: none;">
      <div class="card">
        <h2>ë™ê¸°í™” íˆìŠ¤í† ë¦¬</h2>
        <div id="sync-history" class="sync-logs" style="max-height: 500px;">
          <div class="loading"><div class="spinner"></div>ë¡œë”© ì¤‘...</div>
        </div>
      </div>
    </div>

    <div id="tab-guide-prices" class="tab-content" style="display: none;">
      <!-- ğŸ’° ì‹œê°„ë‹¹ ê°€ê²© ê³„ì‚°ê¸° (í•µì‹¬ ë§ˆì¼€íŒ… ë„êµ¬) -->
      <div class="card" style="background: linear-gradient(135deg, rgba(59,130,246,0.1) 0%, rgba(16,185,129,0.1) 100%); border: 1px solid rgba(59,130,246,0.3);">
        <h2 style="margin-bottom: 4px;">ğŸ’° ì‹œê°„ë‹¹ ê°€ê²© ê³„ì‚°ê¸°</h2>
        <p style="color: #9ca3af; font-size: 14px; margin-bottom: 20px;">ê³ ê° ì¼ì •ì— ìë™ ì ìš©ë˜ëŠ” ê°€ê²© ìˆ˜ì‹ (4ì‹œê°„ ìµœì†Œ ~ 10ì‹œê°„)</p>
        
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px;">
          <!-- ì„¸ë‹¨ (1-4ì¸) -->
          <div style="background: rgba(255,255,255,0.05); border-radius: 12px; padding: 16px; border: 1px solid rgba(255,255,255,0.1);">
            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px;">
              <span style="font-size: 24px;">ğŸš—</span>
              <div>
                <div style="font-weight: 600;">ì„¸ë‹¨ (1-4ì¸)</div>
                <div style="font-size: 12px; color: #9ca3af;">E-Class / ë¹„ì¦ˆë‹ˆìŠ¤ ì„¸ë‹¨</div>
              </div>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
              <div>
                <label style="font-size: 11px; color: #9ca3af; display: block; margin-bottom: 4px;">ê¸°ë³¸ìš”ê¸ˆ (4h)</label>
                <div style="position: relative;">
                  <span style="position: absolute; left: 10px; top: 50%; transform: translateY(-50%); color: #9ca3af;">â‚¬</span>
                  <input type="number" id="sedan-base-price" class="form-input" style="padding-left: 28px;" value="240" onchange="updatePriceFormula()">
                </div>
              </div>
              <div>
                <label style="font-size: 11px; color: #9ca3af; display: block; margin-bottom: 4px;">ì‹œê°„ë‹¹ ì¶”ê°€</label>
                <div style="position: relative;">
                  <span style="position: absolute; left: 10px; top: 50%; transform: translateY(-50%); color: #9ca3af;">â‚¬</span>
                  <input type="number" id="sedan-hourly-price" class="form-input" style="padding-left: 28px;" value="60" onchange="updatePriceFormula()">
                </div>
              </div>
            </div>
            <div style="margin-top: 12px; padding: 8px; background: rgba(59,130,246,0.1); border-radius: 8px; font-size: 13px;">
              <span style="color: #60a5fa;">8ì‹œê°„ ì „ì¼:</span> 
              <span id="sedan-8h-total" style="font-weight: 700; color: #fff;">â‚¬480</span>
            </div>
          </div>
          
          <!-- ë°´ (5-7ì¸) -->
          <div style="background: rgba(255,255,255,0.05); border-radius: 12px; padding: 16px; border: 1px solid rgba(255,255,255,0.1);">
            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px;">
              <span style="font-size: 24px;">ğŸš</span>
              <div>
                <div style="font-weight: 600;">ë°´ (5-7ì¸)</div>
                <div style="font-size: 12px; color: #9ca3af;">V-Class / ëŸ­ì…”ë¦¬ ë°´</div>
              </div>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
              <div>
                <label style="font-size: 11px; color: #9ca3af; display: block; margin-bottom: 4px;">ê¸°ë³¸ìš”ê¸ˆ (4h)</label>
                <div style="position: relative;">
                  <span style="position: absolute; left: 10px; top: 50%; transform: translateY(-50%); color: #9ca3af;">â‚¬</span>
                  <input type="number" id="van-base-price" class="form-input" style="padding-left: 28px;" value="320" onchange="updatePriceFormula()">
                </div>
              </div>
              <div>
                <label style="font-size: 11px; color: #9ca3af; display: block; margin-bottom: 4px;">ì‹œê°„ë‹¹ ì¶”ê°€</label>
                <div style="position: relative;">
                  <span style="position: absolute; left: 10px; top: 50%; transform: translateY(-50%); color: #9ca3af;">â‚¬</span>
                  <input type="number" id="van-hourly-price" class="form-input" style="padding-left: 28px;" value="80" onchange="updatePriceFormula()">
                </div>
              </div>
            </div>
            <div style="margin-top: 12px; padding: 8px; background: rgba(59,130,246,0.1); border-radius: 8px; font-size: 13px;">
              <span style="color: #60a5fa;">8ì‹œê°„ ì „ì¼:</span> 
              <span id="van-8h-total" style="font-weight: 700; color: #fff;">â‚¬640</span>
            </div>
          </div>
          
          <!-- ë¯¸ë‹ˆë²„ìŠ¤ (8ì¸+) -->
          <div style="background: rgba(255,255,255,0.05); border-radius: 12px; padding: 16px; border: 1px solid rgba(255,255,255,0.1);">
            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px;">
              <span style="font-size: 24px;">ğŸšŒ</span>
              <div>
                <div style="font-weight: 600;">ë¯¸ë‹ˆë²„ìŠ¤ (8ì¸+)</div>
                <div style="font-size: 12px; color: #9ca3af;">16-19ì¸ ë¯¸ë‹ˆë²„ìŠ¤</div>
              </div>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
              <div>
                <label style="font-size: 11px; color: #9ca3af; display: block; margin-bottom: 4px;">ê¸°ë³¸ìš”ê¸ˆ (4h)</label>
                <div style="position: relative;">
                  <span style="position: absolute; left: 10px; top: 50%; transform: translateY(-50%); color: #9ca3af;">â‚¬</span>
                  <input type="number" id="minibus-base-price" class="form-input" style="padding-left: 28px;" value="400" onchange="updatePriceFormula()">
                </div>
              </div>
              <div>
                <label style="font-size: 11px; color: #9ca3af; display: block; margin-bottom: 4px;">ì‹œê°„ë‹¹ ì¶”ê°€</label>
                <div style="position: relative;">
                  <span style="position: absolute; left: 10px; top: 50%; transform: translateY(-50%); color: #9ca3af;">â‚¬</span>
                  <input type="number" id="minibus-hourly-price" class="form-input" style="padding-left: 28px;" value="100" onchange="updatePriceFormula()">
                </div>
              </div>
            </div>
            <div style="margin-top: 12px; padding: 8px; background: rgba(59,130,246,0.1); border-radius: 8px; font-size: 13px;">
              <span style="color: #60a5fa;">8ì‹œê°„ ì „ì¼:</span> 
              <span id="minibus-8h-total" style="font-weight: 700; color: #fff;">â‚¬800</span>
            </div>
          </div>
          
          <!-- ê°€ì´ë“œ ì˜¨ë¦¬ -->
          <div style="background: rgba(255,255,255,0.05); border-radius: 12px; padding: 16px; border: 1px solid rgba(255,255,255,0.1);">
            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px;">
              <span style="font-size: 24px;">ğŸ‘¤</span>
              <div>
                <div style="font-weight: 600;">ê°€ì´ë“œ ì˜¨ë¦¬</div>
                <div style="font-size: 12px; color: #9ca3af;">ì°¨ëŸ‰ ì—†ì´ ê°€ì´ë“œë§Œ</div>
              </div>
            </div>
            <div>
              <label style="font-size: 11px; color: #9ca3af; display: block; margin-bottom: 4px;">ì‹œê°„ë‹¹</label>
              <div style="position: relative;">
                <span style="position: absolute; left: 10px; top: 50%; transform: translateY(-50%); color: #9ca3af;">â‚¬</span>
                <input type="number" id="guide-only-hourly" class="form-input" style="padding-left: 28px;" value="50" onchange="updatePriceFormula()">
              </div>
            </div>
            <div style="margin-top: 12px; padding: 8px; background: rgba(16,185,129,0.1); border-radius: 8px; font-size: 13px;">
              <span style="color: #34d399;">8ì‹œê°„ ì „ì¼:</span> 
              <span id="guide-only-8h-total" style="font-weight: 700; color: #fff;">â‚¬400</span>
            </div>
          </div>
        </div>
        
        <div style="margin-top: 20px; display: flex; gap: 12px;">
          <button class="btn btn-primary" onclick="saveHourlyPrices()">ğŸ’¾ ê°€ê²© ì €ì¥</button>
          <button class="btn btn-secondary" onclick="loadHourlyPrices()">ğŸ”„ DBì—ì„œ ë¶ˆëŸ¬ì˜¤ê¸°</button>
        </div>
      </div>
      
      <!-- ğŸ†š ìš°ë²„/íƒì‹œ ë¹„êµí‘œ (ê³ ê° ì„¤ë“ìš©) -->
      <div class="card" style="margin-top: 20px;">
        <h2 style="margin-bottom: 4px;">ğŸ†š ê²½ìŸì‚¬ ë¹„êµí‘œ (8ì‹œê°„ ì „ì¼ ê¸°ì¤€)</h2>
        <p style="color: #9ca3af; font-size: 14px; margin-bottom: 20px;">ê³ ê° ì¼ì •í‘œì— ìë™ìœ¼ë¡œ ë¹„êµë˜ì–´ í‘œì‹œë©ë‹ˆë‹¤</p>
        
        <div style="overflow-x: auto;">
          <table style="width: 100%; border-collapse: collapse; font-size: 14px;">
            <thead>
              <tr style="border-bottom: 1px solid rgba(255,255,255,0.1);">
                <th style="text-align: left; padding: 12px 8px; color: #9ca3af;">ì„œë¹„ìŠ¤</th>
                <th style="text-align: right; padding: 12px 8px; color: #9ca3af;">ì„¸ë‹¨ (1-4ì¸)</th>
                <th style="text-align: right; padding: 12px 8px; color: #9ca3af;">ë°´ (5-7ì¸)</th>
                <th style="text-align: left; padding: 12px 8px; color: #9ca3af;">ë¹„ê³ </th>
              </tr>
            </thead>
            <tbody>
              <tr style="border-bottom: 1px solid rgba(255,255,255,0.05); background: rgba(16,185,129,0.1);">
                <td style="padding: 12px 8px;"><strong>âœ… ê°€ì´ë“œ ì„œë¹„ìŠ¤</strong></td>
                <td style="text-align: right; padding: 12px 8px;"><strong id="compare-sedan">â‚¬480</strong></td>
                <td style="text-align: right; padding: 12px 8px;"><strong id="compare-van">â‚¬640</strong></td>
                <td style="padding: 12px 8px; font-size: 12px; color: #34d399;">ê°€ì´ë“œ í¬í•¨, ì „ì¼ ëŒ€ê¸°, ì£¼ì°¨ë¹„ í¬í•¨</td>
              </tr>
              <tr style="border-bottom: 1px solid rgba(255,255,255,0.05);">
                <td style="padding: 12px 8px;">ğŸš• ìš°ë²„ ë¸”ë™</td>
                <td style="text-align: right; padding: 12px 8px;">
                  <input type="text" id="uber-black-sedan" class="form-input" style="width: 100px; text-align: right;" value="â‚¬450~550" onchange="updateComparisonNote()">
                </td>
                <td style="text-align: right; padding: 12px 8px;">
                  <input type="text" id="uber-black-van" class="form-input" style="width: 100px; text-align: right;" value="â‚¬600~750" onchange="updateComparisonNote()">
                </td>
                <td style="padding: 12px 8px; font-size: 12px; color: #f59e0b;">í˜¸ì¶œë§ˆë‹¤ ëŒ€ê¸°, ê°€ì´ë“œ ì—†ìŒ, ì„œì§€ ë³€ë™</td>
              </tr>
              <tr style="border-bottom: 1px solid rgba(255,255,255,0.05);">
                <td style="padding: 12px 8px;">ğŸš• ìš°ë²„ X</td>
                <td style="text-align: right; padding: 12px 8px;">
                  <input type="text" id="uber-x-sedan" class="form-input" style="width: 100px; text-align: right;" value="â‚¬280~350" onchange="updateComparisonNote()">
                </td>
                <td style="text-align: right; padding: 12px 8px; color: #6b7280;">í•´ë‹¹ ì—†ìŒ</td>
                <td style="padding: 12px 8px; font-size: 12px; color: #ef4444;">ê²½ìœ ì§€ ì¶”ê°€ì‹œ ê¸‰ì¦, ê°€ì´ë“œ ì—†ìŒ</td>
              </tr>
              <tr>
                <td style="padding: 12px 8px;">ğŸš– G7 íƒì‹œ</td>
                <td style="text-align: right; padding: 12px 8px;">
                  <input type="text" id="taxi-sedan" class="form-input" style="width: 100px; text-align: right;" value="â‚¬320~400" onchange="updateComparisonNote()">
                </td>
                <td style="text-align: right; padding: 12px 8px;">
                  <input type="text" id="taxi-van" class="form-input" style="width: 100px; text-align: right;" value="â‚¬450~550" onchange="updateComparisonNote()">
                </td>
                <td style="padding: 12px 8px; font-size: 12px; color: #60a5fa;">ë²„ìŠ¤ ì „ìš©ì°¨ë¡œ ì´ìš© ê°€ëŠ¥</td>
              </tr>
            </tbody>
          </table>
        </div>
        
        <div style="margin-top: 16px; padding: 12px; background: rgba(16,185,129,0.1); border-radius: 8px; border-left: 4px solid #10b981;">
          <div style="font-weight: 600; color: #34d399; margin-bottom: 4px;">ğŸ’¡ ê³ ê°ì—ê²Œ ë³´ì—¬ì¤„ ë©”ì‹œì§€</div>
          <textarea id="comparison-marketing-note" class="form-input" style="width: 100%; min-height: 60px; resize: vertical;" 
            placeholder="ì˜ˆ: ê°€ì´ë“œ ì„œë¹„ìŠ¤ê°€ ìš°ë²„ ëŒ€ë¹„ ìµœëŒ€ â‚¬170 ì ˆì•½! + ì „ë¬¸ ê°€ì´ë“œ ë™í–‰ìœ¼ë¡œ ì‹œê°„ íš¨ìœ¨ 2ë°° â†‘">ê°€ì´ë“œ ì„œë¹„ìŠ¤ê°€ ìš°ë²„ ë¸”ë™ ëŒ€ë¹„ ìµœëŒ€ â‚¬170 ì ˆì•½! ì „ë¬¸ ê°€ì´ë“œ ë™í–‰ìœ¼ë¡œ ì‹œê°„ íš¨ìœ¨ 2ë°° â†‘ ì „ì¼ ëŒ€ê¸°ë¡œ í˜¸ì¶œ ìŠ¤íŠ¸ë ˆìŠ¤ ì—†ìŒ</textarea>
        </div>
        
        <div style="margin-top: 16px;">
          <button class="btn btn-primary" onclick="saveComparisonPrices()">ğŸ’¾ ë¹„êµí‘œ ì €ì¥</button>
        </div>
      </div>
      
      <!-- ê¸°ì¡´ ê°€ì´ë“œ ê°€ê²© ë¦¬ìŠ¤íŠ¸ -->
      <div class="card" style="margin-top: 20px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
          <div>
            <h2 style="margin-bottom: 4px;">ğŸ“‹ ì „ì²´ ê°€ê²©í‘œ</h2>
            <p style="color: #9ca3af; font-size: 14px;">35ë…„ì°¨ íŒŒë¦¬ ê°€ì´ë“œ í˜„ì¥ ë°ì´í„° ê¸°ë°˜ (2026ë…„)</p>
          </div>
          <button class="btn btn-primary" onclick="openAddModal()">+ ìƒˆ ì„œë¹„ìŠ¤ ì¶”ê°€</button>
        </div>
        <div id="guide-prices-list" style="display: flex; flex-direction: column; gap: 12px;">
          <div class="loading"><div class="spinner"></div>ë¡œë”© ì¤‘...</div>
        </div>
      </div>
      
      <!-- ìˆ˜ì • ëª¨ë‹¬ -->
      <div id="guide-price-edit-modal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); z-index: 1000; align-items: center; justify-content: center;">
        <div class="card" style="width: 90%; max-width: 500px; margin: auto;">
          <h2>ê°€ê²© ìˆ˜ì •</h2>
          <form id="guide-price-form" style="display: flex; flex-direction: column; gap: 16px;">
            <input type="hidden" id="edit-price-id">
            <div>
              <label style="font-size: 12px; color: #9ca3af; display: block; margin-bottom: 4px;">ì„œë¹„ìŠ¤ëª…</label>
              <div id="edit-service-name" style="font-size: 16px; font-weight: 600;"></div>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px;">
              <div>
                <label style="font-size: 12px; color: #9ca3af; display: block; margin-bottom: 4px;">ê¸°ë³¸ ê°€ê²©</label>
                <input type="number" id="edit-price-per-day" class="form-input" placeholder="â‚¬">
              </div>
              <div>
                <label style="font-size: 12px; color: #9ca3af; display: block; margin-bottom: 4px;">ìµœì €ê°€</label>
                <input type="number" id="edit-price-low" class="form-input" placeholder="â‚¬">
              </div>
              <div>
                <label style="font-size: 12px; color: #9ca3af; display: block; margin-bottom: 4px;">ìµœê³ ê°€</label>
                <input type="number" id="edit-price-high" class="form-input" placeholder="â‚¬">
              </div>
            </div>
            <div>
              <label style="font-size: 12px; color: #9ca3af; display: block; margin-bottom: 4px;">ì„¤ëª…</label>
              <input type="text" id="edit-description" class="form-input" placeholder="ì„œë¹„ìŠ¤ ì„¤ëª…">
            </div>
            <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 8px;">
              <button type="button" class="btn btn-secondary" onclick="closeEditModal()">ì·¨ì†Œ</button>
              <button type="submit" class="btn btn-primary">ì €ì¥</button>
            </div>
          </form>
        </div>
      </div>
      
      <!-- ì¶”ê°€ ëª¨ë‹¬ -->
      <div id="guide-price-add-modal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); z-index: 1000; align-items: center; justify-content: center;">
        <div class="card" style="width: 90%; max-width: 500px; margin: auto;">
          <h2>ìƒˆ ì„œë¹„ìŠ¤ ì¶”ê°€</h2>
          <form id="guide-price-add-form" style="display: flex; flex-direction: column; gap: 16px;">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
              <div>
                <label style="font-size: 12px; color: #9ca3af; display: block; margin-bottom: 4px;">ì„œë¹„ìŠ¤ ìœ í˜• (ì˜ë¬¸)</label>
                <input type="text" id="add-service-type" class="form-input" placeholder="ì˜ˆ: night_tour" required>
              </div>
              <div>
                <label style="font-size: 12px; color: #9ca3af; display: block; margin-bottom: 4px;">ì„œë¹„ìŠ¤ëª… (í‘œì‹œìš©)</label>
                <input type="text" id="add-service-name" class="form-input" placeholder="ì˜ˆ: ì•¼ê°„ íˆ¬ì–´" required>
              </div>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px;">
              <div>
                <label style="font-size: 12px; color: #9ca3af; display: block; margin-bottom: 4px;">ê¸°ë³¸ ê°€ê²© (â‚¬)</label>
                <input type="number" id="add-price-per-day" class="form-input" placeholder="ì¼ë‹¹/íšŒë‹¹">
              </div>
              <div>
                <label style="font-size: 12px; color: #9ca3af; display: block; margin-bottom: 4px;">ìµœì €ê°€ (â‚¬)</label>
                <input type="number" id="add-price-low" class="form-input" placeholder="ë²”ìœ„ ìµœì €">
              </div>
              <div>
                <label style="font-size: 12px; color: #9ca3af; display: block; margin-bottom: 4px;">ìµœê³ ê°€ (â‚¬)</label>
                <input type="number" id="add-price-high" class="form-input" placeholder="ë²”ìœ„ ìµœê³ ">
              </div>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
              <div>
                <label style="font-size: 12px; color: #9ca3af; display: block; margin-bottom: 4px;">ë‹¨ìœ„</label>
                <select id="add-unit" class="form-input">
                  <option value="day">ì¼ë‹¹ (/ì¼)</option>
                  <option value="trip">íšŒë‹¹ (/íšŒ)</option>
                  <option value="hour">ì‹œê°„ë‹¹ (/ì‹œê°„)</option>
                </select>
              </div>
              <div>
                <label style="font-size: 12px; color: #9ca3af; display: block; margin-bottom: 4px;">ì„¤ëª…</label>
                <input type="text" id="add-description" class="form-input" placeholder="ê°„ë‹¨í•œ ì„¤ëª…">
              </div>
            </div>
            <div>
              <label style="font-size: 12px; color: #9ca3af; display: block; margin-bottom: 4px;">íŠ¹ì§• (ì‰¼í‘œë¡œ êµ¬ë¶„)</label>
              <input type="text" id="add-features" class="form-input" placeholder="ì˜ˆ: í”½ì—… í¬í•¨, ì…ì¥ê¶Œ í¬í•¨, ì‹ì‚¬ í¬í•¨">
            </div>
            <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 8px;">
              <button type="button" class="btn btn-secondary" onclick="closeAddModal()">ì·¨ì†Œ</button>
              <button type="submit" class="btn btn-primary">ì¶”ê°€</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- ğŸš¨ ìœ„ê¸° ì •ë³´ íƒ­ (GDELT + Gemini) -->
    <div id="tab-crisis-alerts" class="tab-content" style="display: none;">
      <div class="card">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
          <div>
            <h2 style="margin-bottom: 4px;">ğŸš¨ ìœ„ê¸° ì •ë³´ ê´€ë¦¬ (GDELT + Gemini)</h2>
            <p style="color: #9ca3af; font-size: 14px;">íŒŒì—…, ì‹œìœ„, êµí†µ ì¥ì• , ê¸°ìƒ ê²½ë³´ ë“± ì—¬í–‰ ì˜í–¥ ì •ë³´</p>
          </div>
          <div style="display: flex; gap: 8px;">
            <button class="btn btn-primary" onclick="collectCrisisAlerts()">ğŸ”„ ì§€ê¸ˆ ìˆ˜ì§‘</button>
            <button class="btn btn-secondary" onclick="loadCrisisAlerts()">ìƒˆë¡œê³ ì¹¨</button>
          </div>
        </div>
        
        <!-- í†µê³„ ì¹´ë“œ -->
        <div class="stat-grid" style="margin-bottom: 20px;">
          <div class="stat-item">
            <div class="stat-value" id="crisis-total">0</div>
            <div class="stat-label">ì´ ì•Œë¦¼</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="crisis-active">0</div>
            <div class="stat-label">í™œì„± ì•Œë¦¼</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="crisis-strike">0</div>
            <div class="stat-label">íŒŒì—…</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="crisis-protest">0</div>
            <div class="stat-label">ì‹œìœ„</div>
          </div>
        </div>
        
        <!-- í•„í„° -->
        <div style="display: flex; gap: 8px; margin-bottom: 16px;">
          <select id="crisis-city-filter" class="form-input" style="min-width: 120px;" onchange="loadCrisisAlerts()">
            <option value="">ì „ì²´ ë„ì‹œ</option>
            <option value="Paris">íŒŒë¦¬</option>
            <option value="London">ëŸ°ë˜</option>
            <option value="Rome">ë¡œë§ˆ</option>
            <option value="Barcelona">ë°”ë¥´ì…€ë¡œë‚˜</option>
          </select>
          <select id="crisis-type-filter" class="form-input" style="min-width: 120px;" onchange="loadCrisisAlerts()">
            <option value="">ì „ì²´ ìœ í˜•</option>
            <option value="strike">íŒŒì—…</option>
            <option value="protest">ì‹œìœ„</option>
            <option value="traffic">êµí†µì¥ì• </option>
            <option value="weather">ê¸°ìƒê²½ë³´</option>
            <option value="security">ë³´ì•ˆ</option>
          </select>
        </div>
        
        <!-- ì•Œë¦¼ ëª©ë¡ -->
        <div id="crisis-alerts-list" style="display: flex; flex-direction: column; gap: 12px;">
          <div class="loading"><div class="spinner"></div>ë¡œë”© ì¤‘...</div>
        </div>
      </div>
    </div>

    <div id="tab-verifications" class="tab-content" style="display: none;">
      <div class="card">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
          <div>
            <h2 style="margin-bottom: 4px;">ê²€ì¦ ìš”ì²­ ê´€ë¦¬</h2>
            <p style="color: #9ca3af; font-size: 14px;">ì‚¬ìš©ìë“¤ì´ ìš”ì²­í•œ ì¼ì • ê²€ì¦ ë‚´ì—­</p>
          </div>
          <div style="display: flex; gap: 8px;">
            <select id="verification-status-filter" class="form-input" style="min-width: 120px;" onchange="loadVerifications()">
              <option value="">ì „ì²´</option>
              <option value="pending">ëŒ€ê¸°ì¤‘</option>
              <option value="in_review">ê²€í† ì¤‘</option>
              <option value="verified">ì™„ë£Œ</option>
              <option value="rejected">ê±°ì ˆ</option>
            </select>
            <button class="btn btn-secondary" onclick="loadVerifications()">ìƒˆë¡œê³ ì¹¨</button>
          </div>
        </div>
        <div id="verifications-list" style="display: flex; flex-direction: column; gap: 12px;">
          <div class="loading"><div class="spinner"></div>ë¡œë”© ì¤‘...</div>
        </div>
      </div>
      
      <div id="verification-detail-modal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); z-index: 1000; align-items: center; justify-content: center; overflow-y: auto;">
        <div class="card" style="width: 95%; max-width: 800px; margin: 40px auto; max-height: 90vh; overflow-y: auto;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
            <h2>ê²€ì¦ ìš”ì²­ ìƒì„¸</h2>
            <button class="btn btn-secondary" onclick="closeVerificationModal()">ë‹«ê¸°</button>
          </div>
          <div id="verification-detail-content"></div>
        </div>
      </div>
    </div>

  </div>
  
  <script>
    const API_BASE = '/api/admin';
    
    const STATUS_MAP = {
      'success': 'ì„±ê³µ',
      'error': 'ì˜¤ë¥˜',
      'pending': 'ì§„í–‰ì¤‘',
      'partial': 'ë¶€ë¶„ì„±ê³µ'
    };
    
    const SERVICE_MAP = {
      'Google Places API': 'Google Places API',
      'Google Maps API': 'Google Maps API',
      'OpenWeather API': 'OpenWeather API',
      'YouTube Data API': 'YouTube Data API',
      'Exchange Rate API': 'í™˜ìœ¨ API',
      'Gemini AI': 'Gemini AI'
    };
    
    // ìƒëŒ€ ì‹œê°„ í¬ë§· í•¨ìˆ˜
    function formatRelativeTime(date) {
      const now = new Date();
      const diff = now - new Date(date);
      const minutes = Math.floor(diff / (1000 * 60));
      const hours = Math.floor(diff / (1000 * 60 * 60));
      const days = Math.floor(diff / (1000 * 60 * 60 * 24));
      
      if (minutes < 60) return `${minutes}ë¶„ ì „`;
      if (hours < 24) return `${hours}ì‹œê°„ ì „`;
      if (days < 7) return `${days}ì¼ ì „`;
      if (days < 30) return `${Math.floor(days / 7)}ì£¼ ì „`;
      return `${Math.floor(days / 30)}ê°œì›” ì „`;
    }
    
    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', () => {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.style.display = 'none');
        tab.classList.add('active');
        document.getElementById(`tab-${tab.dataset.tab}`).style.display = 'block';
        loadTabData(tab.dataset.tab);
      });
    });
    
    async function loadTabData(tab) {
      switch(tab) {
        case 'overview': loadDashboard(); break;
        case 'sources': loadSources(); loadUnifiedSourcesStatus(); break;
        case 'api': loadApiKeys(); loadApiDetail(); loadApiRealStatus(); break;
        case 'logs': loadLogs(); break;
        case 'guide-prices': loadGuidePrices(); break;
        case 'crisis-alerts': loadCrisisAlerts(); break;
        case 'verifications': loadVerifications(); break;
      }
    }
    
    async function loadDashboard() {
      try {
        const [dashRes, freshnessRes, statsRes, alertsRes, controlTowerRes] = await Promise.all([
          fetch(`${API_BASE}/dashboard`),
          fetch(`${API_BASE}/data-freshness`),
          fetch(`${API_BASE}/collection-stats`),
          fetch(`${API_BASE}/data-quality/alerts`),
          fetch(`${API_BASE}/control-tower/summary`)
        ]);
        const dash = await dashRes.json();
        const freshness = await freshnessRes.json();
        const stats = await statsRes.json();
        const alertsData = await alertsRes.json();
        const controlTower = await controlTowerRes.json();
        
        // ğŸ¯ ê´€ì œíƒ‘ ìš”ì•½ ì—…ë°ì´íŠ¸
        document.getElementById('ct-syncs-today').textContent = controlTower.dataCollection?.todaySyncs || 0;
        document.getElementById('ct-success-rate').textContent = `${controlTower.dataCollection?.successRate || 100}%`;
        document.getElementById('ct-api-status').textContent = `${controlTower.apiConnections?.connected || 0}/${controlTower.apiConnections?.total || 0}`;
        document.getElementById('ct-cache-total').textContent = (controlTower.caches?.webSearch || 0) + (controlTower.caches?.routes || 0);
        document.getElementById('control-tower-time').textContent = `ì—…ë°ì´íŠ¸: ${new Date().toLocaleTimeString('ko-KR')}`;
        
        document.getElementById('stat-cities').textContent = dash.overview.cities;
        document.getElementById('stat-places').textContent = dash.overview.places;
        document.getElementById('stat-channels').textContent = dash.overview.youtubeChannels;
        document.getElementById('stat-blogs').textContent = dash.overview.blogSources;
        
        document.getElementById('stat-videos').textContent = stats.totals.youtubeVideos;
        document.getElementById('stat-blog-posts').textContent = stats.totals.blogPosts;
        document.getElementById('stat-place-mentions').textContent = stats.totals.placeMentions;
        document.getElementById('stat-syncs-today').textContent = stats.syncs.today;
        
        const alertsContainer = document.getElementById('alerts-container');
        const alertsEl = document.getElementById('quality-alerts');
        if (alertsData.alerts && alertsData.alerts.length > 0) {
          alertsContainer.style.display = 'block';
          alertsEl.innerHTML = alertsData.alerts.map(a => {
            const iconMap = { error: 'ğŸ”´', warning: 'ğŸŸ¡', info: 'ğŸ”µ' };
            return `<div style="display: flex; justify-content: space-between; align-items: center; padding: 8px 12px; background: rgba(255,255,255,0.03); border-radius: 8px;">
              <span>${iconMap[a.severity] || ''} ${a.message}</span>
              <span style="font-size: 12px; color: #9ca3af;">${a.action || ''}</span>
            </div>`;
          }).join('');
        } else {
          alertsContainer.style.display = 'none';
        }
        
        const chartEl = document.getElementById('weekly-chart');
        const labelsEl = document.getElementById('weekly-labels');
        if (stats.dailyStats && stats.dailyStats.length > 0) {
          const maxTotal = Math.max(...stats.dailyStats.map(d => d.total || 1));
          chartEl.innerHTML = stats.dailyStats.map(d => {
            const height = Math.max(10, (d.total / maxTotal) * 80);
            const successPct = d.total > 0 ? (d.success / d.total) * 100 : 100;
            return `<div style="display: flex; flex-direction: column; align-items: center; gap: 4px;">
              <div style="width: 24px; height: ${height}px; background: linear-gradient(to top, #22c55e ${successPct}%, #ef4444 ${successPct}%); border-radius: 4px;" title="ì„±ê³µ: ${d.success}, ì‹¤íŒ¨: ${d.failed}"></div>
              <span style="font-size: 10px; color: #9ca3af;">${d.total}</span>
            </div>`;
          }).join('');
          labelsEl.innerHTML = stats.dailyStats.map(d => {
            const date = new Date(d.date);
            return `<span>${date.getMonth()+1}/${date.getDate()}</span>`;
          }).join('');
        }
        
        const bar = document.getElementById('freshness-bar');
        const legend = document.getElementById('freshness-legend');
        const total = freshness.total || 1;
        const { summary } = freshness;
        
        bar.innerHTML = Object.entries(summary).map(([key, val]) => 
          `<div class="freshness-segment" style="width: ${(val.count/total)*100}%; background: ${val.color}"></div>`
        ).join('');
        
        legend.innerHTML = Object.entries(summary).map(([key, val]) =>
          `<div class="legend-item"><span class="legend-dot" style="background: ${val.color}"></span>${val.label}: ${val.count}</div>`
        ).join('');
        
        // ì‹¤ì‹œê°„ API ì—°ê²° ìƒíƒœ í™•ì¸ (ì‹¤ì œ ping)
        const servicesEl = document.getElementById('api-services');
        servicesEl.innerHTML = '<div style="text-align: center; padding: 12px; color: #f59e0b;">ì—°ê²° í™•ì¸ ì¤‘...</div>';
        
        const healthRes = await fetch(`${API_BASE}/api-services/health`);
        const healthData = await healthRes.json();
        
        const serviceNames = {
          'google_places': 'Google Places API',
          'google_maps': 'Google Maps API',
          'openweather': 'OpenWeather API',
          'youtube_data': 'YouTube Data API',
          'exchange_rate': 'Exchange Rate API',
          'gemini': 'Gemini AI'
        };
        
        const services = Object.entries(healthData.services || {}).map(([name, health]) => ({
          serviceName: name,
          displayName: serviceNames[name] || name,
          isConnected: health.connected,
          latency: health.latency,
          error: health.error
        }));
        
        updateSystemStatusFromHealth(services);
        
        servicesEl.innerHTML = services.length ? services.map(s => {
          const statusClass = s.isConnected ? 'active' : (s.error === 'API key not configured' ? 'unconfigured' : 'inactive');
          const tooltip = s.isConnected ? `ì—°ê²°ë¨ (${s.latency}ms)` : (s.error || 'ì—°ê²° ì‹¤íŒ¨');
          return `
            <div class="service-item" title="${tooltip}">
              <span class="service-name">${s.displayName}</span>
              <span class="service-status ${statusClass}"></span>
            </div>
          `;
        }).join('') : '<div class="empty-state">ì„œë¹„ìŠ¤ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. <a href="#" onclick="initApiServices()">ì´ˆê¸°í™”í•˜ê¸°</a></div>';
        
        const syncsEl = document.getElementById('recent-syncs');
        syncsEl.innerHTML = dash.recentSyncs.length ? dash.recentSyncs.map(s => `
          <div class="log-item">
            <span>${s.entityType}</span>
            <span class="log-status ${s.status}">${STATUS_MAP[s.status] || s.status}</span>
            <span class="log-time">${new Date(s.startedAt).toLocaleString('ko-KR')}</span>
          </div>
        `).join('') : '<div class="empty-state">ìµœê·¼ ë™ê¸°í™” ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤</div>';
        
        // ğŸ¯ ì¶”ê°€ ë°ì´í„° ë¡œë“œ (ìŠ¤ì¼€ì¤„ëŸ¬, ì¼ì •, ê²½ë¡œ, í˜¼ì¡ë„)
        await loadSchedulerStatus();
        await loadItineraryStats();
        await loadRouteCacheStats();
        await loadPopularityStats();
        await loadKoreanSentimentData();
        
      } catch (err) {
        console.error('ëŒ€ì‹œë³´ë“œ ë¡œë“œ ì˜¤ë¥˜:', err);
        updateSystemStatus([]);
      }
    }
    
    // ğŸ¯ ìŠ¤ì¼€ì¤„ëŸ¬ ì‹¤ì‹œê°„ í˜„í™©
    async function loadSchedulerStatus() {
      try {
        const res = await fetch(`${API_BASE}/scheduler/realtime-status`);
        const data = await res.json();
        
        const statusEl = document.getElementById('scheduler-status');
        statusEl.textContent = data.isRunning ? 'ì‹¤í–‰ ì¤‘' : 'ì¤‘ì§€ë¨';
        statusEl.className = `status-badge ${data.isRunning ? 'status-ok' : 'status-error'}`;
        
        const tasksEl = document.getElementById('scheduler-tasks');
        const statusColors = {
          'success': '#22c55e',
          'failed': '#ef4444',
          'running': '#f59e0b',
          'never': '#6b7280'
        };
        
        tasksEl.innerHTML = data.taskStatuses.map(task => `
          <div style="padding: 12px; background: rgba(255,255,255,0.03); border-radius: 8px; border-left: 3px solid ${statusColors[task.lastStatus] || '#6b7280'};">
            <div style="font-size: 13px; font-weight: 600; margin-bottom: 4px;">${task.taskName.replace(/_/g, ' ')}</div>
            <div style="font-size: 11px; color: #9ca3af;">${task.nextRun}</div>
            <div style="font-size: 10px; color: ${statusColors[task.lastStatus]}; margin-top: 4px;">
              ${task.lastRunAt ? `ë§ˆì§€ë§‰: ${new Date(task.lastRunAt).toLocaleString('ko-KR', { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' })}` : 'ì•„ì§ ì‹¤í–‰ ì•ˆë¨'}
              ${task.lastProcessed > 0 ? ` (${task.lastProcessed}ê±´)` : ''}
            </div>
          </div>
        `).join('');
      } catch (err) {
        console.error('ìŠ¤ì¼€ì¤„ëŸ¬ ìƒíƒœ ë¡œë“œ ì˜¤ë¥˜:', err);
      }
    }
    
    // ğŸ¯ ì¼ì • ìƒì„± í†µê³„
    async function loadItineraryStats() {
      try {
        const res = await fetch(`${API_BASE}/itinerary/stats`);
        const data = await res.json();
        
        document.getElementById('itinerary-today').textContent = data.today || 0;
        document.getElementById('itinerary-week').textContent = data.thisWeek || 0;
        document.getElementById('itinerary-total').textContent = data.total || 0;
        
        if (data.topCities && data.topCities.length > 0) {
          document.getElementById('itinerary-top-cities').textContent = 
            `ì¸ê¸° ë„ì‹œ: ${data.topCities.map(c => `${c.cityName}(${c.count})`).join(', ')}`;
        }
      } catch (err) {
        console.error('ì¼ì • í†µê³„ ë¡œë“œ ì˜¤ë¥˜:', err);
      }
    }
    
    // ğŸ¯ ê²½ë¡œ ìºì‹œ í†µê³„
    async function loadRouteCacheStats() {
      try {
        const res = await fetch(`${API_BASE}/route-cache/stats`);
        const data = await res.json();
        
        document.getElementById('route-total').textContent = data.totalCached || 0;
        document.getElementById('route-week').textContent = data.last7Days || 0;
        
        const modeLabels = { 'DRIVE': 'ğŸš—', 'TRANSIT': 'ğŸš‡', 'WALK': 'ğŸš¶', 'BICYCLE': 'ğŸš´' };
        const byModeEl = document.getElementById('route-by-mode');
        if (data.byTravelMode) {
          byModeEl.innerHTML = Object.entries(data.byTravelMode).map(([mode, count]) => 
            `<span style="font-size: 12px;">${modeLabels[mode] || mode}: ${count}</span>`
          ).join('');
        }
        
        // ë°ì´í„° ì†ŒìŠ¤ íƒ­ ì—…ë°ì´íŠ¸
        document.getElementById('routes-count').textContent = `${data.totalCached || 0} ê²½ë¡œ`;
        document.getElementById('routes-status').textContent = data.status;
        document.getElementById('routes-status').className = `status-badge ${data.status === 'í™œì„±' ? 'status-ok' : 'status-warn'}`;
      } catch (err) {
        console.error('ê²½ë¡œ ìºì‹œ í†µê³„ ë¡œë“œ ì˜¤ë¥˜:', err);
      }
    }
    
    // ğŸ¯ í˜¼ì¡ë„ ë¶„ì„ í†µê³„
    async function loadPopularityStats() {
      try {
        const res = await fetch(`${API_BASE}/popularity/stats`);
        const data = await res.json();

        document.getElementById('popularity-total').textContent = data.totalCached || 0;
        document.getElementById('popularity-24h').textContent = data.last24Hours || 0;

        // ë°ì´í„° ì†ŒìŠ¤ íƒ­ ì—…ë°ì´íŠ¸
        document.getElementById('popularity-count').textContent = `${data.totalCached || 0} ì¥ì†Œ`;
        document.getElementById('popularity-status').textContent = data.status;
        document.getElementById('popularity-status').className = `status-badge ${data.status === 'í™œì„±' ? 'status-ok' : 'status-warn'}`;
      } catch (err) {
        console.error('í˜¼ì¡ë„ í†µê³„ ë¡œë“œ ì˜¤ë¥˜:', err);
      }
    }

    // ğŸ‡°ğŸ‡· í•œêµ­ ê°ì„± ë°ì´í„° ë¡œë“œ (Instagram, ë„¤ì´ë²„, YouTube)
    async function loadKoreanSentimentData() {
      try {
        const [instaRes, naverRes, youtubeRes, cacheRes] = await Promise.all([
          fetch(`${API_BASE}/instagram/stats`),
          fetch(`${API_BASE}/korean-sentiment/naver`),
          fetch(`${API_BASE}/korean-sentiment/youtube`),
          fetch(`${API_BASE}/korean-sentiment/cache-status`)
        ]);
        
        // ìºì‹œ ìƒíƒœ ì—…ë°ì´íŠ¸
        if (cacheRes.ok) {
          const cacheData = await cacheRes.json();
          document.getElementById('cache-total').textContent = cacheData.totalCached || 0;
          document.getElementById('cache-valid').textContent = cacheData.validCount || 0;
          document.getElementById('cache-expired').textContent = cacheData.expiredCount || 0;
          const coverage = cacheData.europeCitiesTotal > 0 
            ? Math.round((cacheData.europeCitiesCovered / cacheData.europeCitiesTotal) * 100) 
            : 0;
          document.getElementById('cache-coverage').textContent = `${coverage}%`;
        }
        
        // Instagram
        const instaData = await instaRes.json();
        document.getElementById('kr-insta-hashtags').textContent = instaData.totalHashtags || 0;
        document.getElementById('kr-insta-photos').textContent = instaData.totalPhotos || 0;
        
        // ê²Œì‹œë¬¼ ìˆ˜ëŠ” í•´ì‹œíƒœê·¸ë³„ í•©ì‚° (APIì—ì„œ ì œê³µ í•„ìš”)
        const totalPostCount = instaData.totalPosts || '-';
        document.getElementById('kr-insta-posts').textContent = typeof totalPostCount === 'number' ? 
          (totalPostCount > 1000000 ? `${(totalPostCount/1000000).toFixed(1)}M` : 
           totalPostCount > 1000 ? `${(totalPostCount/1000).toFixed(1)}K` : totalPostCount) : totalPostCount;
        
        document.getElementById('kr-insta-sync').textContent = instaData.lastSyncAt ? 
          `ë§ˆì§€ë§‰ ë™ê¸°í™”: ${new Date(instaData.lastSyncAt).toLocaleString('ko-KR', { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' })}` : 'ë§ˆì§€ë§‰ ë™ê¸°í™”: -';

        // ë„¤ì´ë²„ ë¸”ë¡œê·¸
        if (naverRes.ok) {
          const naverData = await naverRes.json();
          document.getElementById('kr-naver-posts').textContent = naverData.totalPosts || 0;
          document.getElementById('kr-naver-places').textContent = naverData.linkedPlaces || 0;
          document.getElementById('kr-naver-sentiment').textContent = naverData.positiveSentimentRatio ? 
            `${naverData.positiveSentimentRatio}%` : '-';
          document.getElementById('kr-naver-sync').textContent = naverData.lastSyncAt ? 
            `ë§ˆì§€ë§‰ ë™ê¸°í™”: ${new Date(naverData.lastSyncAt).toLocaleString('ko-KR', { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' })}` : 'ë§ˆì§€ë§‰ ë™ê¸°í™”: -';
        }

        // YouTube
        if (youtubeRes.ok) {
          const youtubeData = await youtubeRes.json();
          document.getElementById('kr-youtube-channels').textContent = youtubeData.totalChannels || 0;
          document.getElementById('kr-youtube-videos').textContent = youtubeData.totalVideos || 0;
          document.getElementById('kr-youtube-mentions').textContent = youtubeData.totalMentions || 0;
          document.getElementById('kr-youtube-sync').textContent = youtubeData.lastSyncAt ? 
            `ë§ˆì§€ë§‰ ë™ê¸°í™”: ${new Date(youtubeData.lastSyncAt).toLocaleString('ko-KR', { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' })}` : 'ë§ˆì§€ë§‰ ë™ê¸°í™”: -';
        }
      } catch (err) {
        console.error('í•œêµ­ ê°ì„± ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', err);
      }
    }

    // ğŸ‡°ğŸ‡· í•œêµ­ ê°ì„± ë°ì´í„° ë™ê¸°í™” í•¨ìˆ˜ë“¤ (Gemini Web Search ê¸°ë°˜)
    // ìœ ëŸ½ 30ê°œ ëŒ€í‘œ ë„ì‹œ ê¸°ë³¸ íƒ‘ì¬
    async function syncKoreanInstagram() {
      if (!confirm('ğŸ“¸ Instagram ê°ì„± ë°ì´í„°ë¥¼ ìœ ëŸ½ 30ê°œ ë„ì‹œì—ì„œ ìˆ˜ì§‘í•©ë‹ˆë‹¤.\n(Gemini AI ê¸°ë°˜, ì•½ 1-2ë¶„ ì†Œìš”)')) return;
      try {
        const btn = event.target;
        btn.disabled = true;
        btn.textContent = 'ë™ê¸°í™” ì¤‘...';
        
        const res = await fetch(`${API_BASE}/korean-sentiment/sync-instagram`, { method: 'POST' });
        const data = await res.json();
        
        alert(`âœ… Instagram ë™ê¸°í™” ì™„ë£Œ!\n\nâ€¢ ìˆ˜ì§‘ ë„ì‹œ: ${data.synced || 0}ê°œ\nâ€¢ ì´ ì˜ˆìƒ ê²Œì‹œë¬¼: ${(data.totalPosts || 0).toLocaleString()}ê°œ\n\nìƒìœ„ ê²°ê³¼:\n${data.results?.slice(0,3).map(r => `- ${r.city}: ${r.hashtags?.join(', ') || 'ì—†ìŒ'}`).join('\n') || 'ì—†ìŒ'}`);
        loadKoreanSentimentData();
      } catch (err) {
        alert('âŒ ë™ê¸°í™” ì‹¤íŒ¨: ' + err.message);
      } finally {
        event.target.disabled = false;
        event.target.textContent = 'ë™ê¸°í™”';
      }
    }

    async function syncKoreanNaverBlog() {
      if (!confirm('ğŸ“ ë„¤ì´ë²„ ë¸”ë¡œê·¸ ê°ì„± ë°ì´í„°ë¥¼ ìœ ëŸ½ 30ê°œ ë„ì‹œì—ì„œ ìˆ˜ì§‘í•©ë‹ˆë‹¤.\n(Gemini AI ê¸°ë°˜, ì•½ 1-2ë¶„ ì†Œìš”)')) return;
      try {
        const btn = event.target;
        btn.disabled = true;
        btn.textContent = 'ë™ê¸°í™” ì¤‘...';
        
        const res = await fetch(`${API_BASE}/korean-sentiment/sync-naver`, { method: 'POST' });
        const data = await res.json();
        
        alert(`âœ… ë„¤ì´ë²„ ë¸”ë¡œê·¸ ë™ê¸°í™” ì™„ë£Œ!\n\nâ€¢ ìˆ˜ì§‘ ë„ì‹œ: ${data.synced || 0}ê°œ\n\nìƒìœ„ ê²°ê³¼:\n${data.results?.slice(0,3).map(r => `- ${r.city}: ${r.sentiment} (${r.keywords?.slice(0,3).join(', ') || 'ì—†ìŒ'})`).join('\n') || 'ì—†ìŒ'}`);
        loadKoreanSentimentData();
      } catch (err) {
        alert('âŒ ë™ê¸°í™” ì‹¤íŒ¨: ' + err.message);
      } finally {
        event.target.disabled = false;
        event.target.textContent = 'ë™ê¸°í™”';
      }
    }

    async function syncKoreanYouTube() {
      if (!confirm('ğŸ¬ YouTube ê°ì„± ë°ì´í„°ë¥¼ ìœ ëŸ½ 30ê°œ ë„ì‹œì—ì„œ ìˆ˜ì§‘í•©ë‹ˆë‹¤.\n(Gemini AI ê¸°ë°˜, ì•½ 1-2ë¶„ ì†Œìš”)')) return;
      try {
        const btn = event.target;
        btn.disabled = true;
        btn.textContent = 'ë™ê¸°í™” ì¤‘...';
        
        const res = await fetch(`${API_BASE}/korean-sentiment/sync-youtube`, { method: 'POST' });
        const data = await res.json();
        
        alert(`âœ… YouTube ë™ê¸°í™” ì™„ë£Œ!\n\nâ€¢ ìˆ˜ì§‘ ë„ì‹œ: ${data.synced || 0}ê°œ\n\nìƒìœ„ ê²°ê³¼:\n${data.results?.slice(0,3).map(r => `- ${r.city}: ${r.videoCount}ê°œ ì˜ìƒ (${r.channels?.slice(0,2).join(', ') || 'ì—†ìŒ'})`).join('\n') || 'ì—†ìŒ'}`);
        loadKoreanSentimentData();
      } catch (err) {
        alert('âŒ ë™ê¸°í™” ì‹¤íŒ¨: ' + err.message);
      } finally {
        event.target.disabled = false;
        event.target.textContent = 'ë™ê¸°í™”';
      }
    }
    
    // ì „ì²´ ìœ ëŸ½ 30ê°œ ë„ì‹œ ì¼ê´„ ë™ê¸°í™”
    async function syncAllKoreanSentiment() {
      if (!confirm('ğŸ‡ªğŸ‡º ìœ ëŸ½ 30ê°œ ëŒ€í‘œ ë„ì‹œì˜ í•œêµ­ ê°ì„± ë°ì´í„°ë¥¼ ì¼ê´„ ìˆ˜ì§‘í•©ë‹ˆë‹¤.\n(Gemini AI ê¸°ë°˜, ì•½ 5-10ë¶„ ì†Œìš”)\n\nê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
      try {
        const res = await fetch(`${API_BASE}/korean-sentiment/sync-all`, { method: 'POST' });
        const data = await res.json();
        
        alert(`âœ… ì „ì²´ ë™ê¸°í™” ì™„ë£Œ!\n\nâ€¢ ì´ ë„ì‹œ: ${data.totalCities}ê°œ\nâ€¢ ì„±ê³µ: ${data.success}ê°œ\nâ€¢ ì‹¤íŒ¨: ${data.errors}ê°œ\n\në°ì´í„°ê°€ ìºì‹œì— ì €ì¥ë˜ì–´ 7ì¼ê°„ ìœ íš¨í•©ë‹ˆë‹¤.`);
        loadKoreanSentimentData();
      } catch (err) {
        alert('âŒ ë™ê¸°í™” ì‹¤íŒ¨: ' + err.message);
      }
    }

    function getServiceStatusClass(service) {
      if (!service.isConfigured) {
        return 'unconfigured';
      }
      if (service.healthStatus) {
        switch (service.healthStatus.status) {
          case 'healthy': return 'active';
          case 'warning': return 'pending';
          case 'error': return 'inactive';
          case 'unknown': return 'unconfigured';
          default: return 'unconfigured';
        }
      }
      return 'active';
    }
    
    function updateSystemStatus(services) {
      const statusEl = document.getElementById('system-status');
      
      if (!services || services.length === 0) {
        statusEl.textContent = 'ì—°ê²° ì˜¤ë¥˜';
        statusEl.className = 'status-badge status-error';
        return;
      }
      
      const hasError = services.some(s => s.healthStatus?.status === 'error');
      const hasWarning = services.some(s => s.healthStatus?.status === 'warning');
      const hasUnconfigured = services.some(s => !s.isConfigured);
      
      if (hasError) {
        statusEl.textContent = 'ì˜¤ë¥˜ ë°œìƒ';
        statusEl.className = 'status-badge status-error';
      } else if (hasWarning) {
        statusEl.textContent = 'ì£¼ì˜ í•„ìš”';
        statusEl.className = 'status-badge status-warn';
      } else if (hasUnconfigured) {
        statusEl.textContent = 'ì¼ë¶€ ë¯¸ì—°ê²°';
        statusEl.className = 'status-badge status-warn';
      } else {
        statusEl.textContent = 'ì‹œìŠ¤í…œ ì •ìƒ';
        statusEl.className = 'status-badge status-ok';
      }
    }
    
    function updateSystemStatusFromHealth(services) {
      const statusEl = document.getElementById('system-status');
      
      if (!services || services.length === 0) {
        statusEl.textContent = 'ì—°ê²° ì˜¤ë¥˜';
        statusEl.className = 'status-badge status-error';
        return;
      }
      
      const connectedCount = services.filter(s => s.isConnected).length;
      const unconfiguredCount = services.filter(s => s.error === 'API key not configured').length;
      const errorCount = services.filter(s => !s.isConnected && s.error !== 'API key not configured').length;
      
      if (errorCount > 0) {
        statusEl.textContent = `ì—°ê²° ì˜¤ë¥˜ (${errorCount}ê°œ)`;
        statusEl.className = 'status-badge status-error';
      } else if (unconfiguredCount > 0) {
        statusEl.textContent = `ì¼ë¶€ ë¯¸ì„¤ì • (${unconfiguredCount}ê°œ)`;
        statusEl.className = 'status-badge status-warn';
      } else {
        statusEl.textContent = `ëª¨ë‘ ì—°ê²°ë¨ (${connectedCount}ê°œ)`;
        statusEl.className = 'status-badge status-ok';
      }
    }
    
    async function loadSources() {
      try {
        const t = Date.now();
        const [ytRes, blogRes] = await Promise.all([
          fetch(`${API_BASE}/youtube-channels?t=${t}`, { cache: 'no-store' }),
          fetch(`${API_BASE}/blog-sources?t=${t}`, { cache: 'no-store' })
        ]);
        const channels = await ytRes.json();
        const blogs = await blogRes.json();
        
        const CATEGORY_MAP = {
          'food': 'ë§›ì§‘',
          'travel': 'ì—¬í–‰',
          'lifestyle': 'ë¼ì´í”„ìŠ¤íƒ€ì¼',
          'Uncategorized': 'ë¯¸ë¶„ë¥˜'
        };
        
        const ytEl = document.getElementById('youtube-channels');
        const now = new Date();
        const sevenDaysAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
        const thirtyDaysAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
        
        ytEl.innerHTML = channels.length ? channels.map(c => {
          // ë™ê¸°í™” ìƒíƒœ ê²°ì •
          let syncClass = 'sync-none';
          let syncTitle = 'ë™ê¸°í™” ì•ˆ ë¨';
          
          if (c.lastVideoSyncAt) {
            const lastSync = new Date(c.lastVideoSyncAt);
            if (lastSync > sevenDaysAgo) {
              syncClass = 'sync-active';
              syncTitle = `í™œì„± (${formatRelativeTime(lastSync)})`;
            } else if (lastSync > thirtyDaysAgo) {
              syncClass = 'sync-stale';
              syncTitle = `ì˜¤ë˜ë¨ (${formatRelativeTime(lastSync)})`;
            } else {
              syncTitle = `ë§Œë£Œ (${formatRelativeTime(lastSync)})`;
            }
          }
          
          // ë™ê¸°í™”ëœ ì˜ìƒ/ì¥ì†Œ ìˆ˜
          const videoCount = c.totalVideosSynced || 0;
          const placeCount = c.totalPlacesMentioned || 0;
          
          return `
          <div class="channel-item" style="display: grid; grid-template-columns: 1fr auto auto auto; align-items: center; gap: 8px;">
            <div class="channel-info">
              <div class="channel-thumb ${syncClass}" title="${syncTitle}"></div>
              <div>
                <div class="channel-name">${c.channelName}</div>
                <span class="channel-category">${CATEGORY_MAP[c.category] || c.category || 'ë¯¸ë¶„ë¥˜'}</span>
                ${videoCount > 0 ? `<span style="font-size: 10px; color: #6b7280; margin-left: 8px;">${videoCount}ì˜ìƒ / ${placeCount}ì¥ì†Œ</span>` : ''}
              </div>
            </div>
            <span class="trust-weight">${c.trustWeight.toFixed(1)}</span>
            <button class="btn btn-secondary" style="padding: 4px 10px; font-size: 12px;" onclick='editYoutubeChannel(${JSON.stringify(c)})'>ìˆ˜ì •</button>
            <button class="btn" style="padding: 4px 10px; font-size: 12px; background: rgba(239,68,68,0.2); color: #ef4444;" onclick="deleteYoutubeChannel(${c.id}, '${c.channelName.replace(/'/g, "\\'")}')">ì‚­ì œ</button>
          </div>
        `}).join('') : '<div class="empty-state">ë“±ë¡ëœ ì±„ë„ì´ ì—†ìŠµë‹ˆë‹¤</div>';
        
        const PLATFORM_MAP = {
          'naver': 'ë„¤ì´ë²„ ë¸”ë¡œê·¸',
          'tistory': 'í‹°ìŠ¤í† ë¦¬',
          'michelin': 'ë¯¸ì‰ë¦° ê°€ì´ë“œ',
          'tripadvisor': 'íŠ¸ë¦½ì–´ë“œë°”ì´ì €'
        };
        
        const blogEl = document.getElementById('blog-sources');
        blogEl.innerHTML = blogs.length ? blogs.map(b => {
          // ë¸”ë¡œê·¸ ì†ŒìŠ¤ ë™ê¸°í™” ìƒíƒœ ê²°ì •
          let syncClass = 'sync-none';
          let syncTitle = 'ë™ê¸°í™” ì•ˆ ë¨';
          
          if (b.lastCrawledAt) {
            const lastSync = new Date(b.lastCrawledAt);
            if (lastSync > sevenDaysAgo) {
              syncClass = 'sync-active';
              syncTitle = `í™œì„± (${formatRelativeTime(lastSync)})`;
            } else if (lastSync > thirtyDaysAgo) {
              syncClass = 'sync-stale';
              syncTitle = `ì˜¤ë˜ë¨ (${formatRelativeTime(lastSync)})`;
            } else {
              syncTitle = `ë§Œë£Œ (${formatRelativeTime(lastSync)})`;
            }
          }
          
          const postCount = b.totalPostsCrawled || 0;
          
          return `
          <div class="channel-item" style="display: grid; grid-template-columns: 1fr auto auto auto; align-items: center; gap: 8px;">
            <div class="channel-info">
              <div class="channel-thumb ${syncClass}" title="${syncTitle}"></div>
              <div>
                <div class="channel-name">${b.sourceName}</div>
                <span class="channel-category">${PLATFORM_MAP[b.platform] || b.platform}</span>
                ${postCount > 0 ? `<span style="font-size: 10px; color: #6b7280; margin-left: 8px;">${postCount}ê°œ í¬ìŠ¤íŠ¸</span>` : ''}
              </div>
            </div>
            <span class="trust-weight">${b.trustWeight.toFixed(1)}</span>
            <button class="btn btn-secondary" style="padding: 4px 10px; font-size: 12px;" onclick='editBlogSource(${JSON.stringify(b)})'>ìˆ˜ì •</button>
            <button class="btn" style="padding: 4px 10px; font-size: 12px; background: rgba(239,68,68,0.2); color: #ef4444;" onclick="deleteBlogSource(${b.id}, '${b.sourceName.replace(/'/g, "\\'")}')">ì‚­ì œ</button>
          </div>
        `}).join('') : '<div class="empty-state">ë“±ë¡ëœ ë¸”ë¡œê·¸ ì†ŒìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤</div>';
        
      } catch (err) {
        console.error('ì†ŒìŠ¤ ë¡œë“œ ì˜¤ë¥˜:', err);
      }
    }
    
    async function loadUnifiedSourcesStatus() {
      try {
        const res = await fetch(`${API_BASE}/data-sources/status`);
        const data = await res.json();
        
        // Google Places
        document.getElementById('google-count').textContent = `${data.google?.count || 0} ì¥ì†Œ`;
        document.getElementById('google-sync').textContent = data.google?.lastSync || '-';
        document.getElementById('google-status').textContent = data.google?.status || 'ëŒ€ê¸°';
        document.getElementById('google-status').className = `status-badge ${data.google?.status === 'í™œì„±' ? 'status-ok' : 'status-warn'}`;
        
        // Instagram
        document.getElementById('instagram-count').textContent = `${data.instagram?.count || 0} í•´ì‹œíƒœê·¸`;
        document.getElementById('instagram-sync').textContent = data.instagram?.lastSync || '-';
        document.getElementById('instagram-status').textContent = data.instagram?.status || 'ëŒ€ê¸°';
        document.getElementById('instagram-status').className = `status-badge ${data.instagram?.status === 'í™œì„±' ? 'status-ok' : 'status-warn'}`;
        
        // YouTube - ì±„ë„, ì˜ìƒ, ì¥ì†Œ ë§¤í•‘ ìˆ˜ í‘œì‹œ
        document.getElementById('youtube-count').innerHTML = `${data.youtube?.count || 0} ì±„ë„`;
        document.getElementById('youtube-videos').textContent = `${data.youtube?.videos || 0} ì˜ìƒ`;
        document.getElementById('youtube-places').textContent = `${data.youtube?.placeMentions || 0} ì¥ì†Œ`;
        document.getElementById('youtube-sync').textContent = data.youtube?.lastSync || '-';
        document.getElementById('youtube-status').textContent = data.youtube?.status || 'ëŒ€ê¸°';
        document.getElementById('youtube-status').className = `status-badge ${data.youtube?.status === 'í™œì„±' ? 'status-ok' : 'status-warn'}`;
        
        // Naver
        document.getElementById('naver-count').textContent = `${data.naver?.count || 0} ì†ŒìŠ¤`;
        document.getElementById('naver-sync').textContent = data.naver?.lastSync || '-';
        document.getElementById('naver-status').textContent = data.naver?.status || 'ëŒ€ê¸°';
        document.getElementById('naver-status').className = `status-badge ${data.naver?.status === 'í™œì„±' ? 'status-ok' : 'status-warn'}`;
        
        // Load hashtags and locations for sources tab
        loadSourcesInstagramData();
        
        // ìƒˆë¡œ ì¶”ê°€ëœ ì†ŒìŠ¤ë“¤ ë¡œë“œ
        loadTistoryStatus();
        loadRouteCacheStats();
        loadPopularityStats();
      } catch (err) {
        console.error('í†µí•© ì†ŒìŠ¤ ìƒíƒœ ë¡œë“œ ì˜¤ë¥˜:', err);
      }
    }
    
    async function loadSourcesInstagramData() {
      try {
        const [hashtagsRes, locationsRes] = await Promise.all([
          fetch(`${API_BASE}/instagram/hashtags`),
          fetch(`${API_BASE}/instagram/locations`)
        ]);
        const hashtags = await hashtagsRes.json();
        const locations = await locationsRes.json();
        
        const hashtagEl = document.getElementById('hashtag-list-sources');
        hashtagEl.innerHTML = hashtags.length ? hashtags.slice(0, 20).map(h => `
          <div class="service-item">
            <span>${h.hashtag}</span>
            <span style="font-size: 12px; color: #9ca3af;">${h.postCount ? h.postCount.toLocaleString() + 'ê°œ' : '-'}</span>
          </div>
        `).join('') : '<div class="empty-state">í•´ì‹œíƒœê·¸ê°€ ì—†ìŠµë‹ˆë‹¤</div>';
        
        const locationEl = document.getElementById('location-list-sources');
        locationEl.innerHTML = locations.length ? locations.slice(0, 20).map(l => `
          <div class="service-item">
            <span>${l.locationName}</span>
            <span style="font-size: 12px; color: #9ca3af;">${l.postCount ? l.postCount.toLocaleString() + 'ê°œ' : '-'}</span>
          </div>
        `).join('') : '<div class="empty-state">ìœ„ì¹˜ íƒœê·¸ê°€ ì—†ìŠµë‹ˆë‹¤</div>';
      } catch (err) {
        console.error('Instagram ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', err);
      }
    }
    
    async function addHashtagFromSources() {
      const hashtag = document.getElementById('new-hashtag-sources').value;
      const category = document.getElementById('hashtag-category-sources').value;
      if (!hashtag) { alert('í•´ì‹œíƒœê·¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”'); return; }
      try {
        await fetch(`${API_BASE}/instagram/hashtags`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ hashtag, category })
        });
        document.getElementById('new-hashtag-sources').value = '';
        loadSourcesInstagramData();
      } catch (err) { alert('ì¶”ê°€ ì‹¤íŒ¨'); }
    }
    
    async function addLocationFromSources() {
      const locationId = document.getElementById('new-location-id-sources').value;
      const locationName = document.getElementById('new-location-name-sources').value;
      if (!locationId || !locationName) { alert('ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”'); return; }
      try {
        await fetch(`${API_BASE}/instagram/locations`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ locationId, locationName })
        });
        document.getElementById('new-location-id-sources').value = '';
        document.getElementById('new-location-name-sources').value = '';
        loadSourcesInstagramData();
      } catch (err) { alert('ì¶”ê°€ ì‹¤íŒ¨'); }
    }
    
    async function syncGooglePlaces() {
      alert('Google Places ë™ê¸°í™”ê°€ ì‹œì‘ë©ë‹ˆë‹¤. ì‹œê°„ì´ ê±¸ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
      try {
        await fetch('/api/sync/city/1/places', { method: 'POST' });
        loadUnifiedSourcesStatus();
      } catch (err) { alert('ë™ê¸°í™” ì‹¤íŒ¨'); }
    }
    
    async function syncNaverBlogs() {
      const resultEl = document.getElementById('sync-result');
      if (resultEl) resultEl.innerHTML = '<span style="color: #f59e0b;">ë„¤ì´ë²„ ë¸”ë¡œê·¸ ë™ê¸°í™” ì¤‘...</span>';
      try {
        const res = await fetch(`${API_BASE}/naver-blog/sync/all`, { method: 'POST' });
        const data = await res.json();
        if (resultEl) resultEl.innerHTML = `<span style="color: #22c55e;">ì™„ë£Œ! ${data.totalPosts || 0}ê°œ í¬ìŠ¤íŠ¸ ìˆ˜ì§‘</span>`;
        loadUnifiedSourcesStatus();
      } catch (err) {
        if (resultEl) resultEl.innerHTML = '<span style="color: #ef4444;">ë™ê¸°í™” ì‹¤íŒ¨</span>';
      }
    }
    
    async function syncTistory() {
      const resultEl = document.getElementById('sync-result');
      if (resultEl) resultEl.innerHTML = '<span style="color: #f59e0b;">í‹°ìŠ¤í† ë¦¬ ë™ê¸°í™” ì¤‘...</span>';
      try {
        const res = await fetch(`${API_BASE}/tistory/sync`, { method: 'POST' });
        const data = await res.json();
        if (resultEl) resultEl.innerHTML = `<span style="color: #22c55e;">ì™„ë£Œ! ${data.totalPosts || 0}ê°œ í¬ìŠ¤íŠ¸, ${data.totalPlaces || 0}ê°œ ì¥ì†Œ ìˆ˜ì§‘</span>`;
        loadUnifiedSourcesStatus();
        loadTistoryStatus();
      } catch (err) {
        if (resultEl) resultEl.innerHTML = '<span style="color: #ef4444;">í‹°ìŠ¤í† ë¦¬ ë™ê¸°í™” ì‹¤íŒ¨</span>';
      }
    }
    
    async function loadTistoryStatus() {
      try {
        const res = await fetch(`${API_BASE}/tistory/stats`);
        const data = await res.json();
        
        document.getElementById('tistory-count').textContent = `${data.totalPosts || 0} í¬ìŠ¤íŠ¸`;
        document.getElementById('tistory-status').textContent = data.status;
        document.getElementById('tistory-status').className = `status-badge ${data.status === 'í™œì„±' ? 'status-ok' : 'status-warn'}`;
        document.getElementById('tistory-sync').textContent = data.lastSync 
          ? new Date(data.lastSync).toLocaleDateString('ko-KR', { month: 'short', day: 'numeric' })
          : '-';
      } catch (err) {
        console.error('í‹°ìŠ¤í† ë¦¬ ìƒíƒœ ë¡œë“œ ì˜¤ë¥˜:', err);
      }
    }
    
    async function loadApiDetail() {
      try {
        const el = document.getElementById('api-detail');
        el.innerHTML = '<div style="text-align: center; padding: 20px; color: #f59e0b;">ì‹¤ì‹œê°„ ì—°ê²° ìƒíƒœ í™•ì¸ ì¤‘...</div>';
        
        // ì‹¤ì‹œê°„ health check API í˜¸ì¶œ
        const healthRes = await fetch(`${API_BASE}/api-services/health`);
        const healthData = await healthRes.json();
        
        const serviceNames = {
          'google_places': 'Google Places API',
          'google_maps': 'Google Maps API',
          'openweather': 'OpenWeather API',
          'youtube_data': 'YouTube Data API',
          'exchange_rate': 'Exchange Rate API',
          'gemini': 'Gemini AI'
        };
        
        const services = Object.entries(healthData.services || {}).map(([name, health]) => ({
          serviceName: name,
          displayName: serviceNames[name] || name,
          isConnected: health.connected,
          latency: health.latency,
          error: health.error,
          lastChecked: health.lastChecked
        }));
        
        updateSystemStatusFromHealth(services);
        
        const serviceItems = services.map(s => {
          const statusClass = s.isConnected ? 'active' : (s.error === 'API key not configured' ? 'unconfigured' : 'inactive');
          const statusLabel = s.isConnected ? 'ì—°ê²°ë¨' : (s.error === 'API key not configured' ? 'í‚¤ ë¯¸ì„¤ì •' : 'ì—°ê²° ì˜¤ë¥˜');
          const lastChecked = s.lastChecked ? new Date(s.lastChecked).toLocaleString('ko-KR') : '-';
          
          return `
            <div class="service-item" style="flex-direction: column; align-items: stretch; gap: 8px;">
              <div style="display: flex; justify-content: space-between; align-items: center;">
                <span class="service-name">${s.displayName}</span>
                <div style="display: flex; gap: 12px; align-items: center;">
                  ${s.isConnected ? `<span style="font-size: 12px; color: #22c55e;">${s.latency}ms</span>` : ''}
                  <span class="service-status ${statusClass}" title="${statusLabel}"></span>
                </div>
              </div>
              <div style="font-size: 11px; color: #6b7280; display: flex; justify-content: space-between;">
                <span>ìƒíƒœ: <span style="color: ${s.isConnected ? '#22c55e' : '#ef4444'}">${statusLabel}</span></span>
                <span>í™•ì¸ ì‹œê°„: ${lastChecked}</span>
              </div>
              ${s.error && s.error !== 'API key not configured' ? `<div style="font-size: 11px; color: #ef4444;">ì˜¤ë¥˜: ${s.error}</div>` : ''}
            </div>
          `;
        }).join('');
        
        el.innerHTML = `
          <div>
            <h3 style="font-size: 14px; color: #a78bfa; margin-bottom: 12px;">ì„œë¹„ìŠ¤ ìƒíƒœ (ì‹¤ì‹œê°„)</h3>
            ${serviceItems || '<div class="empty-state">ì„œë¹„ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤</div>'}
          </div>
        `;
      } catch (err) {
        console.error('API ìƒì„¸ ë¡œë“œ ì˜¤ë¥˜:', err);
        document.getElementById('api-detail').innerHTML = '<div style="color: #ef4444;">ìƒíƒœ í™•ì¸ ì‹¤íŒ¨</div>';
      }
    }
    
    function getStatusLabel(service) {
      if (!service.isConfigured) {
        return 'ë¯¸ì—°ê²°';
      }
      if (service.healthStatus) {
        switch (service.healthStatus.status) {
          case 'healthy': return 'ì •ìƒ';
          case 'warning': return 'ì£¼ì˜';
          case 'error': return 'ì˜¤ë¥˜';
          case 'unknown': return 'ì•Œ ìˆ˜ ì—†ìŒ';
          default: return 'ì•Œ ìˆ˜ ì—†ìŒ';
        }
      }
      return 'ì •ìƒ';
    }
    
    async function loadLogs() {
      try {
        const res = await fetch(`${API_BASE}/sync-logs?limit=100`);
        const logs = await res.json();
        
        const el = document.getElementById('sync-history');
        el.innerHTML = logs.length ? logs.map(l => `
          <div class="log-item">
            <span>${l.entityType} ${l.entityId ? `#${l.entityId}` : ''}</span>
            <span class="log-status ${l.status}">${STATUS_MAP[l.status] || l.status}</span>
            <span style="color: #6b7280;">${l.itemsProcessed || 0}ê°œ ì²˜ë¦¬</span>
            <span class="log-time">${new Date(l.startedAt).toLocaleString('ko-KR')}</span>
          </div>
        `).join('') : '<div class="empty-state">ë™ê¸°í™” ë¡œê·¸ê°€ ì—†ìŠµë‹ˆë‹¤</div>';
      } catch (err) {
        console.error('ë¡œê·¸ ë¡œë“œ ì˜¤ë¥˜:', err);
      }
    }
    
    async function initApiServices() {
      try {
        await fetch(`${API_BASE}/api-services/init`, { method: 'POST' });
        await fetch(`${API_BASE}/schedules/init`, { method: 'POST' });
        alert('ì„œë¹„ìŠ¤ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤!');
        loadDashboard();
        loadApiDetail();
      } catch (err) {
        alert('ì„œë¹„ìŠ¤ ì´ˆê¸°í™”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
      }
    }
    
    async function seedDefaultData() {
      try {
        const res = await fetch(`${API_BASE}/seed/defaults`, { method: 'POST' });
        const data = await res.json();
        alert(`ê¸°ë³¸ ë°ì´í„° ì…ë ¥ ì™„ë£Œ!\nìœ íŠœë¸Œ ì±„ë„: ${data.channelsAdded}ê°œ\në¸”ë¡œê·¸ ì†ŒìŠ¤: ${data.sourcesAdded}ê°œ`);
        loadSources();
        loadDashboard();
      } catch (err) {
        alert('ê¸°ë³¸ ë°ì´í„° ì…ë ¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
      }
    }
    
    async function seedCities() {
      try {
        const res = await fetch(`${API_BASE}/seed/cities`, { method: 'POST' });
        const data = await res.json();
        alert(`ê¸°ë³¸ ë„ì‹œ ë°ì´í„° ì…ë ¥ ì™„ë£Œ!\në„ì‹œ: ${data.citiesAdded}ê°œ`);
        loadDashboard();
      } catch (err) {
        alert('ë„ì‹œ ë°ì´í„° ì…ë ¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
      }
    }
    
    async function seedInstagramHashtags() {
      try {
        const res = await fetch(`${API_BASE}/seed/instagram`, { method: 'POST' });
        const data = await res.json();
        alert(`ê¸°ë³¸ í•´ì‹œíƒœê·¸ ì…ë ¥ ì™„ë£Œ!\ní•´ì‹œíƒœê·¸: ${data.hashtagsAdded}ê°œ`);
        loadInstagramData();
        loadDashboard();
      } catch (err) {
        alert('í•´ì‹œíƒœê·¸ ì…ë ¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
      }
    }
    
    async function syncExchangeRates() {
      const resultEl = document.getElementById('sync-result');
      resultEl.innerHTML = '<span style="color: #f59e0b;">í™˜ìœ¨ ë™ê¸°í™” ì¤‘...</span>';
      try {
        const res = await fetch(`${API_BASE}/sync/exchange-rates`, { method: 'POST' });
        const data = await res.json();
        if (res.ok) {
          resultEl.innerHTML = `<span style="color: #22c55e;">í™˜ìœ¨ ë™ê¸°í™” ì™„ë£Œ! ${data.synced}ê°œ í†µí™” ì—…ë°ì´íŠ¸ë¨</span>`;
          loadDashboard();
          loadLogs();
        } else {
          resultEl.innerHTML = `<span style="color: #ef4444;">ì˜¤ë¥˜: ${data.error}</span>`;
        }
      } catch (err) {
        resultEl.innerHTML = '<span style="color: #ef4444;">í™˜ìœ¨ ë™ê¸°í™”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤</span>';
      }
    }
    
    async function syncYouTube() {
      const resultEl = document.getElementById('sync-result');
      resultEl.innerHTML = '<span style="color: #f59e0b;">ìœ íŠœë¸Œ ë™ê¸°í™” ì¤‘... (ì‹œê°„ì´ ê±¸ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤)</span>';
      try {
        const res = await fetch(`${API_BASE}/sync/youtube`, { method: 'POST' });
        const data = await res.json();
        if (res.ok) {
          resultEl.innerHTML = `<span style="color: #22c55e;">ìœ íŠœë¸Œ ë™ê¸°í™” ì™„ë£Œ! ${data.channelsSynced}ê°œ ì±„ë„, ${data.totalSynced}ê°œ ì˜ìƒ</span>`;
          loadSources();
          loadLogs();
        } else {
          if (data.needsKey) {
            resultEl.innerHTML = `<span style="color: #ef4444;">YouTube API í‚¤ í•„ìš”<br><small>${data.instructions}</small></span>`;
          } else {
            resultEl.innerHTML = `<span style="color: #ef4444;">ì˜¤ë¥˜: ${data.error}</span>`;
          }
        }
      } catch (err) {
        resultEl.innerHTML = '<span style="color: #ef4444;">ìœ íŠœë¸Œ ë™ê¸°í™”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤</span>';
      }
    }
    
    async function syncPlaces() {
      const resultEl = document.getElementById('sync-result');
      resultEl.innerHTML = '<span style="color: #f59e0b;">ì¥ì†Œ ë™ê¸°í™” ì¤‘... (ì„œìš¸)</span>';
      try {
        const res = await fetch(`${API_BASE}/sync/places/1`, { method: 'POST' });
        const data = await res.json();
        if (res.ok) {
          resultEl.innerHTML = `<span style="color: #22c55e;">${data.message} - ${data.synced}ê°œ ì¥ì†Œ ìˆ˜ì§‘ë¨</span>`;
          loadDashboard();
          loadLogs();
        } else {
          resultEl.innerHTML = `<span style="color: #ef4444;">ì˜¤ë¥˜: ${data.error}</span>`;
        }
      } catch (err) {
        resultEl.innerHTML = '<span style="color: #ef4444;">ì¥ì†Œ ë™ê¸°í™”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤</span>';
      }
    }
    
    async function loadApiRealStatus() {
      try {
        const res = await fetch(`${API_BASE}/api-status`);
        const status = await res.json();
        const el = document.getElementById('api-real-status');
        el.innerHTML = `
          <div style="display: grid; gap: 8px;">
            <div>Google Places: <span style="color: ${status.googlePlaces.configured ? '#22c55e' : '#f59e0b'}">${status.googlePlaces.message}</span></div>
            <div>YouTube: <span style="color: ${status.youtube.configured ? '#22c55e' : '#f59e0b'}">${status.youtube.message}</span></div>
            <div>Gemini AI: <span style="color: ${status.gemini.configured ? '#22c55e' : '#f59e0b'}">${status.gemini.message}</span></div>
            <div>í™˜ìœ¨: <span style="color: ${status.exchangeRate.configured ? '#22c55e' : '#f59e0b'}">${status.exchangeRate.message}</span></div>
            <div>ë‚ ì”¨: <span style="color: ${status.openWeather?.configured ? '#22c55e' : '#f59e0b'}">${status.openWeather?.message || 'ë¯¸ì„¤ì •'}</span></div>
          </div>
        `;
      } catch (err) {
        console.error('API ìƒíƒœ ë¡œë“œ ì˜¤ë¥˜:', err);
      }
    }
    
    function toggleForm(id) {
      document.getElementById(id).classList.toggle('active');
    }

    async function loadInstagram() {
      try {
        const [statsRes, hashtagsRes, locationsRes] = await Promise.all([
          fetch(`${API_BASE}/instagram/stats`),
          fetch(`${API_BASE}/instagram/hashtags`),
          fetch(`${API_BASE}/instagram/locations`)
        ]);
        
        const stats = await statsRes.json();
        const hashtags = await hashtagsRes.json();
        const locations = await locationsRes.json();
        
        document.getElementById('stat-hashtags').textContent = stats.totalHashtags;
        document.getElementById('stat-locations').textContent = stats.totalLocations;
        document.getElementById('stat-photos').textContent = stats.totalPhotos;
        document.getElementById('stat-ig-sync').textContent = stats.lastSyncAt 
          ? new Date(stats.lastSyncAt).toLocaleDateString('ko-KR')
          : '-';
        
        const hashtagList = document.getElementById('hashtag-list');
        hashtagList.innerHTML = hashtags.length ? hashtags.map(h => `
          <div class="service-item">
            <div>
              <span style="font-weight: 600;">${h.hashtag}</span>
              <span style="color: #6b7280; font-size: 12px; margin-left: 8px;">
                ${h.postCount ? h.postCount.toLocaleString() + 'ê°œ' : 'ë¯¸ìˆ˜ì§‘'}
              </span>
              ${h.category ? `<span style="color: #a78bfa; font-size: 11px; margin-left: 8px;">${h.category}</span>` : ''}
            </div>
            <div style="display: flex; gap: 8px;">
              <button class="btn btn-sm btn-secondary" onclick="syncHashtag(${h.id})">ë™ê¸°í™”</button>
              <button class="btn btn-sm" style="background: rgba(239,68,68,0.2); color: #ef4444;" onclick="deleteHashtag(${h.id})">ì‚­ì œ</button>
            </div>
          </div>
        `).join('') : '<div class="empty-state">ë“±ë¡ëœ í•´ì‹œíƒœê·¸ê°€ ì—†ìŠµë‹ˆë‹¤</div>';
        
        const locationList = document.getElementById('location-list');
        locationList.innerHTML = locations.length ? locations.map(l => `
          <div class="service-item">
            <div>
              <span style="font-weight: 600;">${l.locationName}</span>
              <span style="color: #6b7280; font-size: 12px; margin-left: 8px;">
                ${l.postCount ? l.postCount.toLocaleString() + 'ê°œ' : 'ë¯¸ìˆ˜ì§‘'}
              </span>
            </div>
            <div style="display: flex; gap: 8px;">
              <button class="btn btn-sm btn-secondary" onclick="syncLocation(${l.id})">ë™ê¸°í™”</button>
              <button class="btn btn-sm" style="background: rgba(239,68,68,0.2); color: #ef4444;" onclick="deleteLocation(${l.id})">ì‚­ì œ</button>
            </div>
          </div>
        `).join('') : '<div class="empty-state">ë“±ë¡ëœ ìœ„ì¹˜ê°€ ì—†ìŠµë‹ˆë‹¤</div>';
        
      } catch (err) {
        console.error('Instagram ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', err);
      }
    }
    
    async function addHashtag() {
      const hashtag = document.getElementById('new-hashtag').value;
      const category = document.getElementById('hashtag-category').value;
      
      if (!hashtag) {
        alert('í•´ì‹œíƒœê·¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”');
        return;
      }
      
      try {
        const res = await fetch(`${API_BASE}/instagram/hashtags`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ hashtag, category })
        });
        if (res.ok) {
          document.getElementById('new-hashtag').value = '';
          toggleForm('hashtag-form');
          loadInstagram();
        } else {
          const err = await res.json();
          alert(err.error || 'ì¶”ê°€ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
        }
      } catch (err) {
        alert('ì¶”ê°€ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
      }
    }
    
    async function deleteHashtag(id) {
      if (!confirm('ì´ í•´ì‹œíƒœê·¸ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
      try {
        await fetch(`${API_BASE}/instagram/hashtags/${id}`, { method: 'DELETE' });
        loadInstagram();
      } catch (err) {
        alert('ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
      }
    }
    
    async function syncHashtag(id) {
      try {
        const res = await fetch(`${API_BASE}/instagram/hashtags/${id}/sync`, { method: 'POST' });
        const data = await res.json();
        if (data.success) {
          alert(`ë™ê¸°í™” ì™„ë£Œ: ${data.postCount?.toLocaleString() || 0}ê°œ ê²Œì‹œë¬¼`);
          loadInstagram();
        } else {
          alert('ë™ê¸°í™” ì‹¤íŒ¨ (Instagram ì ‘ê·¼ ì œí•œ ê°€ëŠ¥)');
        }
      } catch (err) {
        alert('ë™ê¸°í™”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
      }
    }
    
    async function addLocation() {
      const locationId = document.getElementById('new-location-id').value;
      const locationName = document.getElementById('new-location-name').value;
      
      if (!locationId || !locationName) {
        alert('ìœ„ì¹˜ IDì™€ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”');
        return;
      }
      
      try {
        const res = await fetch(`${API_BASE}/instagram/locations`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ locationId, locationName })
        });
        if (res.ok) {
          document.getElementById('new-location-id').value = '';
          document.getElementById('new-location-name').value = '';
          toggleForm('location-form');
          loadInstagram();
        } else {
          const err = await res.json();
          alert(err.error || 'ì¶”ê°€ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
        }
      } catch (err) {
        alert('ì¶”ê°€ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
      }
    }
    
    async function deleteLocation(id) {
      if (!confirm('ì´ ìœ„ì¹˜ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
      try {
        await fetch(`${API_BASE}/instagram/locations/${id}`, { method: 'DELETE' });
        loadInstagram();
      } catch (err) {
        alert('ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
      }
    }
    
    async function syncLocation(id) {
      try {
        const res = await fetch(`${API_BASE}/instagram/locations/${id}/sync`, { method: 'POST' });
        const data = await res.json();
        if (data.success) {
          alert(`ë™ê¸°í™” ì™„ë£Œ: ${data.postCount?.toLocaleString() || 0}ê°œ ê²Œì‹œë¬¼`);
          loadInstagram();
        } else {
          alert('ë™ê¸°í™” ì‹¤íŒ¨ (Instagram ì ‘ê·¼ ì œí•œ ê°€ëŠ¥)');
        }
      } catch (err) {
        alert('ë™ê¸°í™”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
      }
    }
    
    async function seedInstagramData() {
      try {
        const res = await fetch(`${API_BASE}/instagram/seed`, { method: 'POST' });
        const data = await res.json();
        alert(data.message);
        loadInstagram();
      } catch (err) {
        alert('ê¸°ë³¸ ë°ì´í„° ì¶”ê°€ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
      }
    }
    
    async function syncAllInstagram() {
      if (!confirm('ì „ì²´ Instagram ë°ì´í„°ë¥¼ ë™ê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ? (ì‹œê°„ì´ ê±¸ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤)')) return;
      try {
        const res = await fetch(`${API_BASE}/instagram/sync-all`, { method: 'POST' });
        const data = await res.json();
        alert(`ë™ê¸°í™” ì™„ë£Œ:\ní•´ì‹œíƒœê·¸: ${data.hashtags.synced}ê°œ ì„±ê³µ, ${data.hashtags.failed}ê°œ ì‹¤íŒ¨\nìœ„ì¹˜: ${data.locations.synced}ê°œ ì„±ê³µ, ${data.locations.failed}ê°œ ì‹¤íŒ¨`);
        loadInstagram();
      } catch (err) {
        alert('ì „ì²´ ë™ê¸°í™”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
      }
    }
    
    async function addYoutubeChannel() {
      const data = {
        channelId: document.getElementById('yt-channel-id').value,
        channelName: document.getElementById('yt-channel-name').value,
        category: document.getElementById('yt-category').value,
        trustWeight: parseFloat(document.getElementById('yt-trust').value) || 1.0
      };
      
      if (!data.channelId || !data.channelName) {
        alert('ì±„ë„ IDì™€ ì´ë¦„ì€ í•„ìˆ˜ì…ë‹ˆë‹¤');
        return;
      }
      
      try {
        const res = await fetch(`${API_BASE}/youtube-channels`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
        if (res.ok) {
          toggleForm('yt-form');
          loadSources();
        } else {
          const err = await res.json();
          alert(err.error || 'ì±„ë„ ì¶”ê°€ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
        }
      } catch (err) {
        alert('ì±„ë„ ì¶”ê°€ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
      }
    }
    
    async function addBlogSource() {
      const data = {
        platform: document.getElementById('blog-platform').value,
        sourceName: document.getElementById('blog-name').value,
        sourceUrl: document.getElementById('blog-url').value,
        trustWeight: parseFloat(document.getElementById('blog-trust').value) || 1.0
      };
      
      if (!data.platform || !data.sourceName) {
        alert('í”Œë«í¼ê³¼ ì´ë¦„ì€ í•„ìˆ˜ì…ë‹ˆë‹¤');
        return;
      }
      
      try {
        const res = await fetch(`${API_BASE}/blog-sources`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
        if (res.ok) {
          toggleForm('blog-form');
          loadSources();
        } else {
          const err = await res.json();
          alert(err.error || 'ì†ŒìŠ¤ ì¶”ê°€ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
        }
      } catch (err) {
        alert('ì†ŒìŠ¤ ì¶”ê°€ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
      }
    }
    
    // YouTube ì±„ë„ ìˆ˜ì •/ì‚­ì œ
    async function editYoutubeChannel(channel) {
      const newName = prompt('ì±„ë„ëª… ìˆ˜ì •:', channel.channelName);
      if (newName === null) return; // ì·¨ì†Œë¨
      
      const newTrust = prompt('ì‹ ë¢°ë„ (0.1~2.0):', channel.trustWeight);
      if (newTrust === null) return; // ì·¨ì†Œë¨
      
      const finalName = newName.trim() || channel.channelName;
      const trustVal = parseFloat(newTrust) || channel.trustWeight;
      
      try {
        const res = await fetch(`${API_BASE}/youtube-channels/${channel.id}`, {
          method: 'PATCH',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ channelName: finalName, trustWeight: trustVal })
        });
        if (res.ok) {
          await loadSources();
        } else {
          alert('ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
        }
      } catch (err) {
        alert('ìˆ˜ì • ì¤‘ ì˜¤ë¥˜');
      }
    }
    
    async function deleteYoutubeChannel(id, name) {
      if (!confirm(`"${name}" ì±„ë„ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
      try {
        const res = await fetch(`${API_BASE}/youtube-channels/${id}`, { method: 'DELETE' });
        if (res.ok) loadSources();
        else alert('ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
      } catch (err) {
        alert('ì‚­ì œ ì¤‘ ì˜¤ë¥˜');
      }
    }
    
    // ë¸”ë¡œê·¸ ì†ŒìŠ¤ ìˆ˜ì •/ì‚­ì œ
    async function editBlogSource(blog) {
      const newName = prompt('ì†ŒìŠ¤ëª… ìˆ˜ì •:', blog.sourceName);
      if (newName === null) return; // ì·¨ì†Œë¨
      
      const newTrust = prompt('ì‹ ë¢°ë„ (0.1~2.0):', blog.trustWeight);
      if (newTrust === null) return; // ì·¨ì†Œë¨
      
      const finalName = newName.trim() || blog.sourceName;
      const trustVal = parseFloat(newTrust) || blog.trustWeight;
      
      try {
        const res = await fetch(`${API_BASE}/blog-sources/${blog.id}`, {
          method: 'PATCH',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ sourceName: finalName, trustWeight: trustVal })
        });
        if (res.ok) {
          await loadSources();
        } else {
          alert('ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
        }
      } catch (err) {
        alert('ìˆ˜ì • ì¤‘ ì˜¤ë¥˜');
      }
    }
    
    async function deleteBlogSource(id, name) {
      if (!confirm(`"${name}" ì†ŒìŠ¤ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
      try {
        const res = await fetch(`${API_BASE}/blog-sources/${id}`, { method: 'DELETE' });
        if (res.ok) loadSources();
        else alert('ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
      } catch (err) {
        alert('ì‚­ì œ ì¤‘ ì˜¤ë¥˜');
      }
    }
    
    loadDashboard();
    
    // ========================================
    // API í‚¤ ê´€ë¦¬ í•¨ìˆ˜
    // ========================================
    
    async function loadApiKeys() {
      const container = document.getElementById('api-keys-list');
      try {
        const res = await fetch(`${API_BASE}/api-keys`);
        const keys = await res.json();
        
        container.innerHTML = keys.map(key => `
          <div class="service-item" style="flex-direction: column; align-items: stretch;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
              <div>
                <strong style="font-size: 14px;">${key.displayName}</strong>
                <span style="font-size: 12px; color: #9ca3af; margin-left: 8px;">${key.keyName}</span>
              </div>
              <div style="display: flex; align-items: center; gap: 8px;">
                ${key.hasValue 
                  ? `<span class="status-badge status-ok" style="font-size: 11px;">ì„¤ì •ë¨</span>` 
                  : `<span class="status-badge status-warn" style="font-size: 11px;">ë¯¸ì„¤ì •</span>`
                }
                ${key.lastTestResult === 'success' 
                  ? `<span style="color: #22c55e; font-size: 11px;">âœ“ í…ŒìŠ¤íŠ¸ í†µê³¼</span>` 
                  : key.lastTestResult === 'failed' 
                    ? `<span style="color: #ef4444; font-size: 11px;">âœ— í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨</span>`
                    : ''
                }
              </div>
            </div>
            <div style="font-size: 12px; color: #6b7280; margin-bottom: 8px;">${key.description || ''}</div>
            <div style="display: flex; gap: 8px;">
              <input type="password" id="key-input-${key.keyName}" class="form-input" 
                     style="flex: 1; font-size: 13px;" 
                     placeholder="${key.hasValue ? key.keyValue : 'API í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”...'}"
                     value="">
              <button class="btn btn-primary" style="font-size: 12px; padding: 6px 12px;" 
                      onclick="saveApiKey('${key.keyName}')">ì €ì¥</button>
              <button class="btn btn-secondary" style="font-size: 12px; padding: 6px 12px;" 
                      onclick="testApiKey('${key.keyName}')">í…ŒìŠ¤íŠ¸</button>
            </div>
            <div id="key-result-${key.keyName}" style="margin-top: 8px; padding: 8px 12px; border-radius: 6px; font-size: 12px; min-height: 20px; background: rgba(255,255,255,0.03);"></div>
          </div>
        `).join('');
      } catch (err) {
        container.innerHTML = '<div style="color: #ef4444;">API í‚¤ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</div>';
      }
    }
    
    async function saveApiKey(keyName) {
      const input = document.getElementById(`key-input-${keyName}`);
      const resultEl = document.getElementById(`key-result-${keyName}`);
      const keyValue = input.value.trim();
      
      if (!keyValue) {
        resultEl.innerHTML = '<span style="color: #f59e0b;">âš ï¸ API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”</span>';
        resultEl.style.background = 'rgba(245, 158, 11, 0.1)';
        return;
      }
      
      resultEl.innerHTML = '<span style="color: #f59e0b;">â³ ì €ì¥ ì¤‘...</span>';
      resultEl.style.background = 'rgba(245, 158, 11, 0.1)';
      
      try {
        const res = await fetch(`${API_BASE}/api-keys/${keyName}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ keyValue })
        });
        const data = await res.json();
        
        if (res.ok) {
          resultEl.innerHTML = '<span style="color: #22c55e; font-weight: 600;">âœ… ì €ì¥ ì™„ë£Œ! ì¦‰ì‹œ ë°˜ì˜ë˜ì—ˆìŠµë‹ˆë‹¤.</span>';
          resultEl.style.background = 'rgba(34, 197, 94, 0.15)';
          input.value = '';
          setTimeout(() => {
            loadApiKeys();
            loadApiRealStatus();
          }, 1000);
        } else {
          resultEl.innerHTML = `<span style="color: #ef4444;">âŒ ì˜¤ë¥˜: ${data.error}</span>`;
          resultEl.style.background = 'rgba(239, 68, 68, 0.1)';
        }
      } catch (err) {
        resultEl.innerHTML = '<span style="color: #ef4444;">âŒ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤</span>';
        resultEl.style.background = 'rgba(239, 68, 68, 0.1)';
      }
    }
    
    async function testApiKey(keyName) {
      const resultEl = document.getElementById(`key-result-${keyName}`);
      
      // í‚¤ê°€ ì €ì¥ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
      const input = document.getElementById(`key-input-${keyName}`);
      const hasValue = input.value.trim() || input.placeholder.includes('...');
      
      if (!hasValue) {
        resultEl.innerHTML = '<span style="color: #f59e0b;">âš ï¸ ë¨¼ì € API í‚¤ë¥¼ ì €ì¥í•´ì£¼ì„¸ìš”</span>';
        resultEl.style.background = 'rgba(245, 158, 11, 0.1)';
        return;
      }
      
      resultEl.innerHTML = '<span style="color: #f59e0b;">â³ API ì—°ê²° í…ŒìŠ¤íŠ¸ ì¤‘...</span>';
      resultEl.style.background = 'rgba(245, 158, 11, 0.1)';
      
      try {
        const res = await fetch(`${API_BASE}/api-keys/${keyName}/test`, {
          method: 'POST'
        });
        const data = await res.json();
        
        if (data.success) {
          resultEl.innerHTML = `<span style="color: #22c55e; font-weight: 600;">âœ… í…ŒìŠ¤íŠ¸ ì„±ê³µ! ${data.message}</span>`;
          resultEl.style.background = 'rgba(34, 197, 94, 0.15)';
        } else {
          resultEl.innerHTML = `<span style="color: #ef4444;">âŒ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${data.message}</span>`;
          resultEl.style.background = 'rgba(239, 68, 68, 0.1)';
        }
        
        setTimeout(loadApiKeys, 1500);
      } catch (err) {
        resultEl.innerHTML = '<span style="color: #ef4444;">âŒ í…ŒìŠ¤íŠ¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤</span>';
        resultEl.style.background = 'rgba(239, 68, 68, 0.1)';
      }
    }
    
    function openAddApiKeyModal() {
      document.getElementById('add-api-key-modal').style.display = 'flex';
      document.getElementById('new-key-name').value = '';
      document.getElementById('new-key-display-name').value = '';
      document.getElementById('new-key-description').value = '';
      document.getElementById('new-key-value').value = '';
    }
    
    function closeAddApiKeyModal() {
      document.getElementById('add-api-key-modal').style.display = 'none';
    }
    
    // ìƒˆ API í‚¤ ì¶”ê°€ í¼ ì œì¶œ
    document.addEventListener('DOMContentLoaded', () => {
      const form = document.getElementById('add-api-key-form');
      if (form) {
        form.addEventListener('submit', async (e) => {
          e.preventDefault();
          const keyName = document.getElementById('new-key-name').value.trim().toUpperCase();
          const displayName = document.getElementById('new-key-display-name').value.trim();
          const description = document.getElementById('new-key-description').value.trim();
          const keyValue = document.getElementById('new-key-value').value.trim();
          
          if (!keyName || !displayName || !keyValue) {
            alert('í•„ìˆ˜ í•­ëª©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”');
            return;
          }
          
          try {
            // DBì— ìƒˆ í‚¤ ì¶”ê°€
            const res = await fetch(`${API_BASE}/api-keys`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ keyName, displayName, description, keyValue })
            });
            
            const data = await res.json();
            
            if (res.ok) {
              alert('âœ… API í‚¤ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!');
              closeAddApiKeyModal();
              loadApiKeys();
              loadApiRealStatus();
            } else {
              alert(data.error || 'API í‚¤ ì¶”ê°€ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
            }
          } catch (err) {
            alert('API í‚¤ ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤');
            console.error(err);
          }
        });
      }
    });
    
    // ê°€ì´ë“œ ê°€ê²© ê´€ë ¨ í•¨ìˆ˜
    async function loadGuidePrices() {
      const container = document.getElementById('guide-prices-list');
      try {
        const res = await fetch(`${API_BASE}/guide-prices?t=${Date.now()}`, {
          cache: 'no-store'
        });
        const prices = await res.json();
        prices.sort((a, b) => a.id - b.id);
        
        if (prices.length === 0) {
          container.innerHTML = `
            <div style="text-align: center; padding: 40px; color: #6b7280;">
              <p>ê°€ê²© ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</p>
              <button class="btn btn-primary" onclick="seedGuidePrices()" style="margin-top: 16px;">ê¸°ë³¸ ê°€ê²© ì…ë ¥</button>
            </div>`;
          return;
        }
        
        const unitLabels = { day: '/ì¼', trip: '/íšŒ', hour: '/ì‹œê°„' };
        container.innerHTML = prices.map(p => `
          <div class="service-item" style="display: grid; grid-template-columns: 1fr auto auto auto; align-items: center; gap: 12px;">
            <div>
              <div style="font-weight: 600; font-size: 15px;">${p.serviceName}</div>
              <div style="font-size: 11px; color: #6b7280;">${p.serviceType}</div>
              <div style="font-size: 12px; color: #9ca3af; margin-top: 2px;">${p.description || ''}</div>
              <div style="font-size: 11px; color: #6b7280; margin-top: 4px;">
                ${p.features ? p.features.map(f => `<span style="background: rgba(255,255,255,0.05); padding: 2px 8px; border-radius: 4px; margin-right: 4px;">${f}</span>`).join('') : ''}
              </div>
            </div>
            <div style="text-align: right;">
              <div style="font-size: 20px; font-weight: 700; color: #a78bfa;">
                ${p.pricePerDay ? `â‚¬${p.pricePerDay}` : `â‚¬${p.priceLow}~${p.priceHigh}`}
              </div>
              <div style="font-size: 11px; color: #6b7280;">${unitLabels[p.unit] || p.unit}</div>
            </div>
            <button class="btn btn-secondary" onclick='openEditModal(${JSON.stringify(p)})' style="padding: 8px 16px;">ìˆ˜ì •</button>
            <button class="btn" style="padding: 8px 12px; background: rgba(239,68,68,0.2); color: #ef4444;" onclick="deleteGuidePrice(${p.id}, '${p.serviceName.replace(/'/g, "\\'")}')">ì‚­ì œ</button>
          </div>
        `).join('');
      } catch (err) {
        container.innerHTML = `<div style="color: #ef4444;">ê°€ê²© ë¡œë”© ì‹¤íŒ¨: ${err.message}</div>`;
      }
    }
    
    function openEditModal(price) {
      document.getElementById('edit-price-id').value = price.id;
      document.getElementById('edit-service-name').textContent = price.serviceName;
      document.getElementById('edit-price-per-day').value = price.pricePerDay || '';
      document.getElementById('edit-price-low').value = price.priceLow || '';
      document.getElementById('edit-price-high').value = price.priceHigh || '';
      document.getElementById('edit-description').value = price.description || '';
      document.getElementById('guide-price-edit-modal').style.display = 'flex';
    }
    
    function closeEditModal() {
      document.getElementById('guide-price-edit-modal').style.display = 'none';
    }
    
    document.getElementById('guide-price-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const id = document.getElementById('edit-price-id').value;
      const data = {
        pricePerDay: parseFloat(document.getElementById('edit-price-per-day').value) || null,
        priceLow: parseFloat(document.getElementById('edit-price-low').value) || null,
        priceHigh: parseFloat(document.getElementById('edit-price-high').value) || null,
        description: document.getElementById('edit-description').value
      };
      
      try {
        const res = await fetch(`${API_BASE}/guide-prices/${id}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
        if (res.ok) {
          closeEditModal();
          loadGuidePrices();
        } else {
          alert('ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
        }
      } catch (err) {
        alert('ì €ì¥ ì¤‘ ì˜¤ë¥˜: ' + err.message);
      }
    });
    
    function openAddModal() {
      document.getElementById('add-service-type').value = '';
      document.getElementById('add-service-name').value = '';
      document.getElementById('add-price-per-day').value = '';
      document.getElementById('add-price-low').value = '';
      document.getElementById('add-price-high').value = '';
      document.getElementById('add-unit').value = 'day';
      document.getElementById('add-description').value = '';
      document.getElementById('add-features').value = '';
      document.getElementById('guide-price-add-modal').style.display = 'flex';
    }
    
    function closeAddModal() {
      document.getElementById('guide-price-add-modal').style.display = 'none';
    }
    
    document.getElementById('guide-price-add-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const featuresStr = document.getElementById('add-features').value;
      const features = featuresStr ? featuresStr.split(',').map(f => f.trim()).filter(f => f) : [];
      
      const data = {
        serviceType: document.getElementById('add-service-type').value,
        serviceName: document.getElementById('add-service-name').value,
        pricePerDay: parseFloat(document.getElementById('add-price-per-day').value) || null,
        priceLow: parseFloat(document.getElementById('add-price-low').value) || null,
        priceHigh: parseFloat(document.getElementById('add-price-high').value) || null,
        unit: document.getElementById('add-unit').value,
        description: document.getElementById('add-description').value,
        features
      };
      
      try {
        const res = await fetch(`${API_BASE}/guide-prices`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
        if (res.ok) {
          closeAddModal();
          loadGuidePrices();
        } else {
          const err = await res.json();
          alert(err.error || 'ì¶”ê°€ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
        }
      } catch (err) {
        alert('ì¶”ê°€ ì¤‘ ì˜¤ë¥˜: ' + err.message);
      }
    });
    
    async function deleteGuidePrice(id, name) {
      if (!confirm(`"${name}" ì„œë¹„ìŠ¤ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
      
      try {
        const res = await fetch(`${API_BASE}/guide-prices/${id}`, { method: 'DELETE' });
        if (res.ok) {
          loadGuidePrices();
        } else {
          alert('ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
        }
      } catch (err) {
        alert('ì‚­ì œ ì¤‘ ì˜¤ë¥˜: ' + err.message);
      }
    }
    
    async function seedGuidePrices() {
      try {
        const res = await fetch(`${API_BASE}/guide-prices/seed`, { method: 'POST' });
        const data = await res.json();
        if (data.success) {
          alert(`${data.count}ê°œ ê°€ê²© ë°ì´í„°ê°€ ì…ë ¥ë˜ì—ˆìŠµë‹ˆë‹¤`);
          loadGuidePrices();
        }
      } catch (err) {
        alert('ì‹œë“œ ë°ì´í„° ì…ë ¥ ì‹¤íŒ¨');
      }
    }
    
    // ========================================
    // ğŸ’° ì‹œê°„ë‹¹ ê°€ê²© ê³„ì‚° í•¨ìˆ˜
    // ========================================
    
    function updatePriceFormula() {
      // ì„¸ë‹¨ 8ì‹œê°„ ê³„ì‚°
      const sedanBase = parseFloat(document.getElementById('sedan-base-price').value) || 240;
      const sedanHourly = parseFloat(document.getElementById('sedan-hourly-price').value) || 60;
      const sedan8h = sedanBase + (4 * sedanHourly); // ê¸°ë³¸ 4h + ì¶”ê°€ 4h
      document.getElementById('sedan-8h-total').textContent = `â‚¬${sedan8h}`;
      document.getElementById('compare-sedan').textContent = `â‚¬${sedan8h}`;
      
      // ë°´ 8ì‹œê°„ ê³„ì‚°
      const vanBase = parseFloat(document.getElementById('van-base-price').value) || 320;
      const vanHourly = parseFloat(document.getElementById('van-hourly-price').value) || 80;
      const van8h = vanBase + (4 * vanHourly);
      document.getElementById('van-8h-total').textContent = `â‚¬${van8h}`;
      document.getElementById('compare-van').textContent = `â‚¬${van8h}`;
      
      // ë¯¸ë‹ˆë²„ìŠ¤ 8ì‹œê°„ ê³„ì‚°
      const minibusBase = parseFloat(document.getElementById('minibus-base-price').value) || 400;
      const minibusHourly = parseFloat(document.getElementById('minibus-hourly-price').value) || 100;
      const minibus8h = minibusBase + (4 * minibusHourly);
      document.getElementById('minibus-8h-total').textContent = `â‚¬${minibus8h}`;
      
      // ê°€ì´ë“œ ì˜¨ë¦¬ 8ì‹œê°„ ê³„ì‚°
      const guideHourly = parseFloat(document.getElementById('guide-only-hourly').value) || 50;
      const guide8h = guideHourly * 8;
      document.getElementById('guide-only-8h-total').textContent = `â‚¬${guide8h}`;
      
      updateComparisonNote();
    }
    
    function updateComparisonNote() {
      const sedan8h = parseFloat(document.getElementById('compare-sedan').textContent.replace('â‚¬', ''));
      const uberBlackSedan = document.getElementById('uber-black-sedan').value;
      
      // ìš°ë²„ ë¸”ë™ ìµœê³ ê°€ ì¶”ì¶œ (ì˜ˆ: "â‚¬450~550" â†’ 550)
      const uberHighMatch = uberBlackSedan.match(/(\d+)$/);
      const uberHigh = uberHighMatch ? parseInt(uberHighMatch[1]) : 550;
      
      const savings = uberHigh - sedan8h;
      if (savings > 0) {
        const noteEl = document.getElementById('comparison-marketing-note');
        if (noteEl && !noteEl.dataset.userEdited) {
          noteEl.value = `ê°€ì´ë“œ ì„œë¹„ìŠ¤ê°€ ìš°ë²„ ë¸”ë™ ëŒ€ë¹„ ìµœëŒ€ â‚¬${savings} ì ˆì•½! ì „ë¬¸ ê°€ì´ë“œ ë™í–‰ìœ¼ë¡œ ì‹œê°„ íš¨ìœ¨ 2ë°° â†‘ ì „ì¼ ëŒ€ê¸°ë¡œ í˜¸ì¶œ ìŠ¤íŠ¸ë ˆìŠ¤ ì—†ìŒ`;
        }
      }
    }
    
    async function saveHourlyPrices() {
      const hourlyPrices = {
        sedan: {
          basePrice4h: parseFloat(document.getElementById('sedan-base-price').value) || 240,
          pricePerHour: parseFloat(document.getElementById('sedan-hourly-price').value) || 60,
          minPassengers: 1,
          maxPassengers: 4
        },
        van: {
          basePrice4h: parseFloat(document.getElementById('van-base-price').value) || 320,
          pricePerHour: parseFloat(document.getElementById('van-hourly-price').value) || 80,
          minPassengers: 5,
          maxPassengers: 7
        },
        minibus: {
          basePrice4h: parseFloat(document.getElementById('minibus-base-price').value) || 400,
          pricePerHour: parseFloat(document.getElementById('minibus-hourly-price').value) || 100,
          minPassengers: 8,
          maxPassengers: 20
        },
        guide_only: {
          basePrice4h: 0,
          pricePerHour: parseFloat(document.getElementById('guide-only-hourly').value) || 50,
          minPassengers: 1,
          maxPassengers: 20
        }
      };
      
      // ë¹„êµí‘œ ë°ì´í„°
      const comparison = {
        uberBlack: {
          sedan: document.getElementById('uber-black-sedan').value,
          van: document.getElementById('uber-black-van').value
        },
        uberX: {
          sedan: document.getElementById('uber-x-sedan').value
        },
        taxi: {
          sedan: document.getElementById('taxi-sedan').value,
          van: document.getElementById('taxi-van').value
        },
        marketingNote: document.getElementById('comparison-marketing-note').value
      };
      
      try {
        const res = await fetch(`${API_BASE}/guide-prices/hourly`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ hourlyPrices, comparison })
        });
        
        if (res.ok) {
          const data = await res.json();
          alert('âœ… ì‹œê°„ë‹¹ ê°€ê²©ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
          loadGuidePrices();
        } else {
          const err = await res.json();
          alert('ì €ì¥ ì‹¤íŒ¨: ' + (err.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
        }
      } catch (err) {
        alert('ì €ì¥ ì¤‘ ì˜¤ë¥˜: ' + err.message);
      }
    }
    
    async function loadHourlyPrices() {
      try {
        const res = await fetch(`${API_BASE}/guide-prices/hourly`);
        if (!res.ok) return;
        
        const data = await res.json();
        
        if (data.sedan) {
          document.getElementById('sedan-base-price').value = data.sedan.basePrice4h || 240;
          document.getElementById('sedan-hourly-price').value = data.sedan.pricePerHour || 60;
        }
        if (data.van) {
          document.getElementById('van-base-price').value = data.van.basePrice4h || 320;
          document.getElementById('van-hourly-price').value = data.van.pricePerHour || 80;
        }
        if (data.minibus) {
          document.getElementById('minibus-base-price').value = data.minibus.basePrice4h || 400;
          document.getElementById('minibus-hourly-price').value = data.minibus.pricePerHour || 100;
        }
        if (data.guide_only) {
          document.getElementById('guide-only-hourly').value = data.guide_only.pricePerHour || 50;
        }
        
        // ë¹„êµí‘œ ë¡œë“œ
        if (data.comparison) {
          if (data.comparison.uberBlack) {
            document.getElementById('uber-black-sedan').value = data.comparison.uberBlack.sedan || 'â‚¬450~550';
            document.getElementById('uber-black-van').value = data.comparison.uberBlack.van || 'â‚¬600~750';
          }
          if (data.comparison.uberX) {
            document.getElementById('uber-x-sedan').value = data.comparison.uberX.sedan || 'â‚¬280~350';
          }
          if (data.comparison.taxi) {
            document.getElementById('taxi-sedan').value = data.comparison.taxi.sedan || 'â‚¬320~400';
            document.getElementById('taxi-van').value = data.comparison.taxi.van || 'â‚¬450~550';
          }
          if (data.comparison.marketingNote) {
            document.getElementById('comparison-marketing-note').value = data.comparison.marketingNote;
            document.getElementById('comparison-marketing-note').dataset.userEdited = 'true';
          }
        }
        
        updatePriceFormula();
      } catch (err) {
        console.error('ì‹œê°„ë‹¹ ê°€ê²© ë¡œë“œ ì‹¤íŒ¨:', err);
      }
    }
    
    async function saveComparisonPrices() {
      await saveHourlyPrices(); // ê°™ì€ API ì‚¬ìš©
    }
    
    // ê°€ì´ë“œ ê°€ê²© íƒ­ ë¡œë“œì‹œ ì‹œê°„ë‹¹ ê°€ê²©ë„ ë¡œë“œ
    const originalLoadGuidePrices = loadGuidePrices;
    loadGuidePrices = async function() {
      await originalLoadGuidePrices();
      await loadHourlyPrices();
    };
    
    let autoRefreshInterval = null;
    let lastUpdateTime = new Date();
    
    function updateRefreshTime() {
      const el = document.getElementById('last-update');
      if (el) {
        el.textContent = `ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: ${lastUpdateTime.toLocaleTimeString('ko-KR')}`;
      }
    }
    
    async function refreshAll() {
      const activeTab = document.querySelector('.tab.active')?.dataset.tab || 'overview';
      await loadTabData(activeTab);
      lastUpdateTime = new Date();
      updateRefreshTime();
    }
    
    function startAutoRefresh() {
      if (autoRefreshInterval) clearInterval(autoRefreshInterval);
      autoRefreshInterval = setInterval(refreshAll, 30000);
      console.log('ìë™ ìƒˆë¡œê³ ì¹¨ ì‹œì‘ (30ì´ˆ ê°„ê²©)');
    }
    
    function stopAutoRefresh() {
      if (autoRefreshInterval) {
        clearInterval(autoRefreshInterval);
        autoRefreshInterval = null;
        console.log('ìë™ ìƒˆë¡œê³ ì¹¨ ì¤‘ì§€');
      }
    }
    
    startAutoRefresh();
    
    document.addEventListener('visibilitychange', () => {
      if (document.hidden) {
        stopAutoRefresh();
      } else {
        refreshAll();
        startAutoRefresh();
      }
    });
    
    const VERIFICATION_STATUS_MAP = {
      'pending': { label: 'ëŒ€ê¸°ì¤‘', color: '#f59e0b', bg: 'rgba(245,158,11,0.2)' },
      'in_review': { label: 'ê²€í† ì¤‘', color: '#3b82f6', bg: 'rgba(59,130,246,0.2)' },
      'verified': { label: 'ì™„ë£Œ', color: '#22c55e', bg: 'rgba(34,197,94,0.2)' },
      'rejected': { label: 'ê±°ì ˆ', color: '#ef4444', bg: 'rgba(239,68,68,0.2)' }
    };
    
    // =============================================
    // ğŸš¨ ìœ„ê¸° ì •ë³´ ê´€ë¦¬ (GDELT + Gemini)
    // =============================================
    
    const CRISIS_TYPE_MAP = {
      'strike': { label: 'íŒŒì—…', icon: 'ğŸª§', color: '#ef4444' },
      'protest': { label: 'ì‹œìœ„', icon: 'ğŸ“¢', color: '#f59e0b' },
      'traffic': { label: 'êµí†µ', icon: 'ğŸš—', color: '#3b82f6' },
      'weather': { label: 'ê¸°ìƒ', icon: 'â›ˆï¸', color: '#06b6d4' },
      'security': { label: 'ë³´ì•ˆ', icon: 'ğŸš¨', color: '#dc2626' }
    };
    
    async function loadCrisisAlerts() {
      const container = document.getElementById('crisis-alerts-list');
      const cityFilter = document.getElementById('crisis-city-filter').value;
      const typeFilter = document.getElementById('crisis-type-filter').value;
      
      try {
        let url = '/api/admin/crisis-alerts';
        const params = new URLSearchParams();
        if (cityFilter) params.set('city', cityFilter);
        if (typeFilter) params.set('type', typeFilter);
        if (params.toString()) url += `?${params.toString()}`;
        
        const res = await fetch(url);
        const data = await res.json();
        
        // í†µê³„ ì—…ë°ì´íŠ¸
        document.getElementById('crisis-total').textContent = data.stats?.totalAlerts || 0;
        document.getElementById('crisis-active').textContent = data.stats?.activeAlerts || 0;
        document.getElementById('crisis-strike').textContent = data.stats?.byType?.strike || 0;
        document.getElementById('crisis-protest').textContent = data.stats?.byType?.protest || 0;
        
        const alerts = data.alerts || [];
        
        if (alerts.length === 0) {
          container.innerHTML = `
            <div style="text-align: center; padding: 40px; color: #6b7280;">
              <p>ğŸ‰ í˜„ì¬ í™œì„±í™”ëœ ìœ„ê¸° ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤</p>
              <p style="font-size: 14px; margin-top: 8px;">ì—¬í–‰í•˜ê¸° ì¢‹ì€ ë‚ ì”¨ì…ë‹ˆë‹¤!</p>
            </div>`;
          return;
        }
        
        container.innerHTML = alerts.map(alert => {
          const typeInfo = CRISIS_TYPE_MAP[alert.type] || CRISIS_TYPE_MAP.security;
          const severityColor = alert.severity >= 7 ? '#ef4444' : alert.severity >= 4 ? '#f59e0b' : '#22c55e';
          
          return `
            <div class="service-item" style="display: grid; grid-template-columns: auto 1fr auto; align-items: start; gap: 16px; padding: 16px;">
              <div style="font-size: 32px;">${typeInfo.icon}</div>
              <div>
                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px;">
                  <span style="font-weight: 700; font-size: 16px;">${alert.titleKo || alert.title}</span>
                  <span style="padding: 2px 8px; border-radius: 8px; font-size: 11px; background: rgba(255,255,255,0.1); color: ${typeInfo.color};">${typeInfo.label}</span>
                </div>
                <div style="color: #9ca3af; font-size: 13px; margin-bottom: 8px;">
                  ğŸ“ ${alert.city} | ğŸ“… ${alert.date}${alert.endDate ? ` ~ ${alert.endDate}` : ''}
                </div>
                <div style="color: #d1d5db; font-size: 13px; margin-bottom: 8px;">
                  ${alert.description || ''}
                </div>
                ${alert.affected && alert.affected.length > 0 ? `
                  <div style="display: flex; gap: 4px; flex-wrap: wrap; margin-bottom: 8px;">
                    ${alert.affected.map(a => `<span style="padding: 2px 8px; border-radius: 6px; font-size: 11px; background: rgba(239,68,68,0.2); color: #fca5a5;">${a}</span>`).join('')}
                  </div>
                ` : ''}
                <div style="background: rgba(34,197,94,0.1); padding: 8px 12px; border-radius: 8px; color: #86efac; font-size: 13px;">
                  ğŸ’¡ ${alert.recommendationKo || alert.recommendation || 'ê°€ì´ë“œ ì„œë¹„ìŠ¤ ì´ìš©ì„ ê¶Œì¥í•©ë‹ˆë‹¤'}
                </div>
              </div>
              <div style="display: flex; flex-direction: column; align-items: flex-end; gap: 8px;">
                <div style="padding: 4px 12px; border-radius: 8px; font-size: 12px; font-weight: 700; background: ${severityColor}20; color: ${severityColor};">
                  ì‹¬ê°ë„ ${alert.severity}/10
                </div>
                <button class="btn btn-secondary" style="font-size: 12px; padding: 4px 12px;" onclick="deactivateCrisisAlert(${alert.id})">ë¹„í™œì„±í™”</button>
              </div>
            </div>`;
        }).join('');
        
      } catch (err) {
        console.error('ìœ„ê¸° ì •ë³´ ë¡œë“œ ì˜¤ë¥˜:', err);
        container.innerHTML = `<div style="color: #ef4444; text-align: center; padding: 20px;">ë¡œë“œ ì‹¤íŒ¨: ${err.message}</div>`;
      }
    }
    
    async function collectCrisisAlerts() {
      try {
        const btn = event.target;
        btn.disabled = true;
        btn.textContent = 'ìˆ˜ì§‘ ì¤‘...';
        
        const res = await fetch('/api/admin/crisis-alerts/collect', { method: 'POST' });
        const result = await res.json();
        
        if (result.success) {
          alert(`âœ… ìˆ˜ì§‘ ì™„ë£Œ!\nê¸°ì‚¬: ${result.totalArticles}ê°œ\nì•Œë¦¼: ${result.totalAlerts}ê°œ\nì €ì¥: ${result.savedAlerts}ê°œ`);
          loadCrisisAlerts();
        } else {
          alert('âŒ ìˆ˜ì§‘ ì‹¤íŒ¨: ' + (result.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
        }
      } catch (err) {
        alert('âŒ ìˆ˜ì§‘ ì˜¤ë¥˜: ' + err.message);
      } finally {
        event.target.disabled = false;
        event.target.textContent = 'ğŸ”„ ì§€ê¸ˆ ìˆ˜ì§‘';
      }
    }
    
    async function deactivateCrisisAlert(alertId) {
      if (!confirm('ì´ ì•Œë¦¼ì„ ë¹„í™œì„±í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
      
      try {
        const res = await fetch(`/api/admin/crisis-alerts/${alertId}/deactivate`, { method: 'POST' });
        const result = await res.json();
        
        if (result.success) {
          loadCrisisAlerts();
        } else {
          alert('âŒ ë¹„í™œì„±í™” ì‹¤íŒ¨');
        }
      } catch (err) {
        alert('âŒ ì˜¤ë¥˜: ' + err.message);
      }
    }
    
    // =============================================
    // ê²€ì¦ ìš”ì²­ ê´€ë¦¬
    // =============================================
    
    async function loadVerifications() {
      const container = document.getElementById('verifications-list');
      const statusFilter = document.getElementById('verification-status-filter').value;
      
      try {
        let url = '/api/verification/requests';
        if (statusFilter) url += `?status=${statusFilter}`;
        
        const res = await fetch(url);
        const requests = await res.json();
        
        if (requests.length === 0) {
          container.innerHTML = `
            <div style="text-align: center; padding: 40px; color: #6b7280;">
              <p>ê²€ì¦ ìš”ì²­ì´ ì—†ìŠµë‹ˆë‹¤</p>
            </div>`;
          return;
        }
        
        container.innerHTML = requests.map(req => {
          const status = VERIFICATION_STATUS_MAP[req.status] || VERIFICATION_STATUS_MAP.pending;
          const itinerary = req.itineraryData || {};
          const createdAt = new Date(req.createdAt).toLocaleDateString('ko-KR');
          
          return `
            <div class="service-item" style="display: grid; grid-template-columns: auto 1fr auto auto; align-items: center; gap: 16px; cursor: pointer;" onclick="openVerificationDetail(${req.id})">
              <span style="padding: 4px 12px; border-radius: 12px; font-size: 12px; font-weight: 600; background: ${status.bg}; color: ${status.color};">
                ${status.label}
              </span>
              <div>
                <div style="font-weight: 600; font-size: 15px;">${itinerary.destination || 'ì•Œ ìˆ˜ ì—†ìŒ'} - ${itinerary.days?.length || 0}ì¼</div>
                <div style="font-size: 12px; color: #6b7280; margin-top: 2px;">
                  ${itinerary.startDate || ''} ~ ${itinerary.endDate || ''} | ìš”ì²­ì¼: ${createdAt}
                </div>
                ${req.userMessage ? `<div style="font-size: 12px; color: #9ca3af; margin-top: 4px; font-style: italic;">"${req.userMessage.substring(0, 50)}${req.userMessage.length > 50 ? '...' : ''}"</div>` : ''}
              </div>
              <div style="text-align: right; font-size: 12px; color: #6b7280;">
                #${req.id}
              </div>
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#6b7280" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg>
            </div>
          `;
        }).join('');
      } catch (err) {
        container.innerHTML = `<div style="color: #ef4444;">ë¡œë”© ì‹¤íŒ¨: ${err.message}</div>`;
      }
    }
    
    async function openVerificationDetail(id) {
      const modal = document.getElementById('verification-detail-modal');
      const content = document.getElementById('verification-detail-content');
      
      content.innerHTML = '<div class="loading"><div class="spinner"></div>ë¡œë”© ì¤‘...</div>';
      modal.style.display = 'flex';
      
      try {
        const res = await fetch(`/api/verification/requests/${id}`);
        const req = await res.json();
        const status = VERIFICATION_STATUS_MAP[req.status] || VERIFICATION_STATUS_MAP.pending;
        const itinerary = req.itineraryData || {};
        
        let placesHtml = '';
        if (itinerary.days && itinerary.days.length > 0) {
          itinerary.days.forEach((day, dayIdx) => {
            placesHtml += `<div style="margin-bottom: 16px;">
              <div style="font-weight: 600; margin-bottom: 8px; color: #a78bfa;">Day ${day.day} - ${day.city || ''}</div>
              ${(day.places || []).map((p, pIdx) => `
                <div style="display: flex; gap: 12px; padding: 8px; background: rgba(255,255,255,0.03); border-radius: 8px; margin-bottom: 4px;">
                  <span style="color: #a78bfa; font-weight: 600;">${pIdx + 1}</span>
                  <div style="flex: 1;">
                    <div style="font-weight: 500;">${p.name}</div>
                    <div style="font-size: 12px; color: #6b7280;">${p.startTime || ''} - ${p.endTime || ''}</div>
                  </div>
                  <span style="color: #22c55e; font-size: 12px;">Score: ${p.vibeScore || 0}</span>
                </div>
              `).join('')}
            </div>`;
          });
        }
        
        content.innerHTML = `
          <div style="display: flex; gap: 8px; align-items: center; margin-bottom: 16px;">
            <span style="padding: 6px 16px; border-radius: 16px; font-size: 14px; font-weight: 600; background: ${status.bg}; color: ${status.color};">
              ${status.label}
            </span>
            <span style="color: #6b7280; font-size: 14px;">#${req.id} | ${new Date(req.createdAt).toLocaleString('ko-KR')}</span>
          </div>
          
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
            <div style="padding: 16px; background: rgba(255,255,255,0.03); border-radius: 12px;">
              <div style="font-size: 12px; color: #6b7280; margin-bottom: 4px;">ëª©ì ì§€</div>
              <div style="font-size: 18px; font-weight: 700;">${itinerary.destination || '-'}</div>
            </div>
            <div style="padding: 16px; background: rgba(255,255,255,0.03); border-radius: 12px;">
              <div style="font-size: 12px; color: #6b7280; margin-bottom: 4px;">ì—¬í–‰ ê¸°ê°„</div>
              <div style="font-size: 18px; font-weight: 700;">${itinerary.days?.length || 0}ì¼</div>
              <div style="font-size: 12px; color: #6b7280;">${itinerary.startDate || ''} ~ ${itinerary.endDate || ''}</div>
            </div>
          </div>
          
          ${req.userMessage ? `
            <div style="padding: 16px; background: rgba(167,139,250,0.1); border-radius: 12px; margin-bottom: 16px;">
              <div style="font-size: 12px; color: #a78bfa; margin-bottom: 4px;">ì‚¬ìš©ì ë©”ì‹œì§€</div>
              <div style="font-size: 14px;">${req.userMessage}</div>
            </div>
          ` : ''}
          
          <div style="margin-bottom: 16px;">
            <div style="font-size: 14px; font-weight: 600; margin-bottom: 8px;">ì¼ì • ìƒì„¸</div>
            <div style="max-height: 300px; overflow-y: auto;">
              ${placesHtml || '<div style="color: #6b7280;">ì¼ì • ì •ë³´ ì—†ìŒ</div>'}
            </div>
          </div>
          
          <div style="border-top: 1px solid rgba(255,255,255,0.1); padding-top: 16px;">
            <div style="font-size: 14px; font-weight: 600; margin-bottom: 8px;">ê´€ë¦¬ì ì½”ë©˜íŠ¸</div>
            <textarea id="admin-comment-${req.id}" class="form-input" style="width: 100%; min-height: 80px; margin-bottom: 12px;" placeholder="ì‚¬ìš©ìì—ê²Œ ì „ë‹¬í•  ì½”ë©˜íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”...">${req.adminComment || ''}</textarea>
            
            <div style="display: flex; gap: 8px; justify-content: flex-end;">
              <button class="btn btn-secondary" onclick="updateVerificationStatus(${req.id}, 'in_review')">ê²€í† ì¤‘</button>
              <button class="btn" style="background: rgba(239,68,68,0.2); color: #ef4444;" onclick="updateVerificationStatus(${req.id}, 'rejected')">ê±°ì ˆ</button>
              <button class="btn btn-primary" onclick="updateVerificationStatus(${req.id}, 'verified')">ê²€ì¦ ì™„ë£Œ</button>
            </div>
          </div>
        `;
      } catch (err) {
        content.innerHTML = `<div style="color: #ef4444;">ë¡œë”© ì‹¤íŒ¨: ${err.message}</div>`;
      }
    }
    
    function closeVerificationModal() {
      document.getElementById('verification-detail-modal').style.display = 'none';
    }
    
    async function updateVerificationStatus(id, status) {
      const comment = document.getElementById(`admin-comment-${id}`)?.value || '';
      
      try {
        const res = await fetch(`/api/verification/requests/${id}`, {
          method: 'PATCH',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ status, adminComment: comment })
        });
        
        if (res.ok) {
          closeVerificationModal();
          loadVerifications();
          alert(status === 'verified' ? 'ê²€ì¦ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤' : 'ìƒíƒœê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤');
        } else {
          alert('ì—…ë°ì´íŠ¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
        }
      } catch (err) {
        alert('ì˜¤ë¥˜: ' + err.message);
      }
    }
  </script>
</body>
</html>
