# AG2 반경 100km 적용 · 배포 · 결과 분석 · 프론트엔드 피드백

> **작성일**: 2026-02-10  
> **목적**: AG2(Gemini) 1차 일정 요청 프롬프트에 "사용자 입력 도시 반경 100km 내외" 반영 후, 파리 기준 수정·내부테스트·배포·실제 결과 분석·보고·최종 프론트엔드 피드백 문서화

---

## 1. 적용 내용

| 항목 | 내용 |
|------|------|
| **대상** | AG2(Gemini Creative Recommender) — 1차 일정 요청 프롬프트 |
| **추가 문구** | "Only recommend places within about 100km radius of the destination city (city center + suburbs). This matches our data coverage." |
| **의미** | Place Seed·AG3 매칭 범위(도시 반경 100km)와 동일하게 제한 → 추천 장소가 DB/구글맵 데이터와 일치하도록 유도 |
| **파리 기준** | 예시(Example)를 Paris로 명시: Eiffel Tower, Le Bouillon Chartier |

**수정 파일**
- `server/services/agents/ag2-gemini-recommender.ts` — 프롬프트 본문 + 예시 라벨
- `docs/AGENT_PROTOCOL.md` — AG2 규칙에 "반경 100km 내외 필수" 추가

---

## 2. 내부 테스트 결과

| 검증 항목 | 결과 | 비고 |
|-----------|------|------|
| **코드 반영** | ✅ | AG2 프롬프트 100km 문구 + Paris 예시 확인 |
| **프로토콜 문서** | ✅ | AGENT_PROTOCOL AG2 섹션 반경 규칙 추가 |
| **서버 빌드** | ✅ | `npm run server:build` 성공 |

---

## 3. 배포 절차 (Koyeb)

- **커밋·푸시하면 Koyeb으로 자동 배포** (적용). 로컬호스트는 **내부테스트용**.
- DB·대시보드에 구글맵 API는 이미 설정된 상태로 가정.

| 단계 | 작업 |
|------|------|
| 1 | `cursor-dev`(또는 배포 브랜치)에 변경사항 커밋·푸시 |
| 2 | Koyeb 자동 배포 완료 대기 |
| 3 | 건강체크 URL로 200 확인 후, 아래 "실제 결과 분석" 실행 (배포 URL 기준) |

---

## 4. 실제 결과 분석 (배포 후)

**파리 기준 1회 일정 생성 호출**

- **로컬**: `.\dev\test-paris-a.ps1` (서버가 `http://localhost:8082`일 때)
- **배포 서버**: 동일 바디로 `POST https://<배포도메인>/api/routes/generate` 호출

**확인 사항**

1. **응답**: `days[].places`에 장소가 채워지는지, 도시가 Paris(또는 파리)인지.
2. **로그**: 서버 로그에 `[AG2] 🤖 Gemini에 N곳 요청` 이후 정상 응답 수신 여부.
3. **반경 일치**: 추천된 장소가 파리 시내·근교(100km 내)인지 샘플로 확인 (예: 베르사유 포함 OK, 리옹 등 원거리 X).

**보고 템플릿 (배포 후 채워서 공유)**

```
■ AG2 100km 적용 배포 후 결과
- 배포 완료 시각:
- 파리 1회 생성 호출 시각:
- 응답: 일수 / 장소 수 / 첫 3곳 이름:
- 로그: AG2 요청·응답 정상 여부:
- 비고 (오류·이상 시):
```

---

## 5. 최종 프론트엔드 결과 피드백 (문서)

배포 및 실제 결과 분석까지 완료한 뒤, 프론트엔드에 전달할 요약입니다.

| 항목 | 내용 |
|------|------|
| **변경 요약** | AG2 1차 일정 요청 시 "사용자 입력 도시 반경 100km 내외"로 추천 제한 적용됨. |
| **기대 효과** | 추천 장소가 우리 DB·Place Seed(100km)·구글맵 데이터와 맞아서, 매칭률·표시 안정성 향상. |
| **프론트 반영** | 별도 API 스펙 변경 없음. 일정 결과(`days[].places`)는 기존과 동일 구조. 표시 시 "도시 중심·근교 100km 이내" 문구 노출 가능(선택). |
| **이슈 시** | 특정 도시에서 장소가 비거나 이상하면, 해당 도시 Place Seed 현황(또는 AG3 매칭 로그)과 함께 공유 요청. |

— **문서 작업과 동시에** 반영 완료. 배포 후 위 "실제 결과 분석" 실행 → 보고 템플릿 채움 → 필요 시 이 문서에 결과를 추가하여 최종 프론트엔드 피드백으로 전달하면 됩니다.
