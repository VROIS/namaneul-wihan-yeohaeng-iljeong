# NUBI 프로젝트 태스크 관리

> **최종 업데이트: 2026-02-10**
> **완료된 작업 이력: `docs/TASK_ARCHIVE.md`**
> **AI 규칙: `.cursor/rules/*.mdc` (9개 파일, 항상 자동 적용)**

---

## 0. 현재 진행 상태 (AI 핸드오프용)

> 이 섹션은 `.cursor/rules/nubi-handoff.mdc`와 동기화. 상세 상태는 handoff 참조.

| 항목 | 내용 |
|------|------|
| **마지막 작업일** | 2026-02-10 |
| **마지막 작업** | 일정 검증(90% 이상만 노출) 구현 + pipeline-v3·orchestrator 적용 + 문서화 |
| **다음 할 일** | 배포 후 실제테스트·결과 보고 → 건강체크 API 수정 → 프론트엔드 nubiReason |
| **배포 상태** | Koyeb 정상 (200 OK). 커밋·푸시 시 자동 배포. 로컬 = 내부테스트용. |
| **브랜치** | cursor-dev |

---

## 1. 긴급 이슈

| # | 이슈 | 상태 | 해결 방법 |
|---|------|------|----------|
| 1 | **Google Maps/Places 대시보드 빨간불** | 미해결 | 건강체크가 Geocoding API 테스트 → Places API (New) 테스트로 변경 필요 |
| 2 | **Place Seed 0/71 도시** | 미해결 | Google Places API 활성 확인 후 파리부터 공식 시딩 |
| 3 | ~~API 비용 폭탄 (€1,171)~~ | **해결** | apiCallTracker, routeCallTracker 적용 완료 |

---

## 2. 진행 예정 작업 (우선순위순)

### 스트림 A: 백엔드 로직 완성

| # | 작업 | 상태 | 핵심 파일 |
|---|------|------|----------|
| A-1 | **city_transport_fares DB 테이블 생성** | 예정 | shared/schema.ts |
| A-2 | **60개 도시 교통 요금 수집** (우버블랙+대중교통) | 예정 | 크롤러/Gemini |
| A-3 | **transport-pricing 하드코딩→DB 조회 전환** | 예정 | transport-pricing-service.ts |
| A-4 | **주 1회 교통요금 자동 업데이트 스케줄러** | 예정 | data-scheduler.ts |
| A-5 | **미등록 도시: 실시간 API→DB 캐시** | 예정 | transport-pricing-service.ts |
| A-6 | 입장료 수집 강화 (실제 데이터 우선) | 예정 | price-crawler.ts |
| A-7 | 식사비 최대값 적용 (구글맵 추정치) | 예정 | pipeline-v3.ts |

### 스트림 B: 프론트엔드 UI/UX 개편

| # | 작업 | 상태 | 핵심 파일 |
|---|------|------|----------|
| B-1 | **nubiReason 표시** (크게/진하게, 절대 빈값 불가) | 예정 | TripPlannerScreen.tsx |
| B-2 | **교통비 A/B 분기 표시** (가이드 vs 대중교통) | 예정 | TripPlannerScreen.tsx |
| B-3 | **Pipeline V3 응답→프론트 데이터 매핑** | 예정 | TripPlannerScreen.tsx |
| B-4 | **긴 한 페이지 구조** (일별 탭 제거, 세로 나열) | 예정 | TripPlannerScreen.tsx |
| B-5 | **로딩 페이지 실시간 계산과정** (8-10단계 메시지) | 예정 | TripPlannerScreen.tsx |
| B-6 | 슬롯 색상 구분 (관광 파랑/점심 주황/저녁 빨강) | 예정 | TripPlannerScreen.tsx |
| B-7 | 상단 여행요약 (가중치 수식, 인당비용, 지도 토글) | 예정 | TripPlannerScreen.tsx |
| B-8 | 하단 5탭 개편 (일정/지도/전문가/프로필/설정) | 예정 | MainTabNavigator.tsx |
| B-9 | 썸네일 이미지 필수 (Google/인스타/Wikimedia) | 예정 | TripPlannerScreen.tsx |
| B-10 | 날씨/위기 경보 상단 표시 | 예정 | TripPlannerScreen.tsx |
| B-11 | NUBI 추천 점수 (별표+소수점) | 예정 | TripPlannerScreen.tsx |

### 스트림 C: 수익화

| # | 작업 | 상태 | 핵심 파일 |
|---|------|------|----------|
| C-1 | **가이드 예약 유도 폼** (업셀 클릭→장점+예약) | 예정 | 신규 |
| C-2 | Stripe/인앱결제 연동 | 예정 | 신규 |

### 스트림 D: 데이터 확보

| # | 작업 | 상태 | 비고 |
|---|------|------|------|
| D-1 | **장소 시딩 1차: 유럽 5개 도시** (파리,런던,로마,바르셀로나,프라하) | 대기 | API 활성 후 자동 (전 도시 100km 반경 적용 완료, 내부테스트 보고: docs/PLACE_SEED_100KM_TEST_REPORT.md) |
| D-2 | 장소 시딩 2차: 프랑스 30개 도시 | 대기 | 1차 후 자동 이어서 |
| D-3 | 장소 시딩 3차: 유럽 30개 도시 | 대기 | 2차 후 자동 이어서 |

### 스트림 E: 영상 (우선순위 낮음)

| # | 작업 | 상태 | 비고 |
|---|------|------|------|
| E-1 | Seedance 모델 활성화 대기 | 대기 | ModelNotOpen 상태 |
| E-2 | 나머지 캐릭터 4명 (F4,M5,M6,F6) | 미착수 | |
| E-3 | 다중 씬 합성 (Remotion) | 미착수 | |
| E-4 | TTS 음성 연동 | 미착수 | |

---

## 3. 수집 데이터 현황

| 데이터 | 수량 | 최근 동기화 |
|--------|------|------------|
| 도시 | 71개 | 2026-02-08 |
| 장소 | 1,669개 | 진행 중 (시딩 0/71) |
| YouTube | 18채널, 54영상, 23언급 | 2026-02-09 |
| 네이버 블로그 | 1,239개 (14개 도시) | 2026-02-09 |
| 인스타그램 | 해시태그 3,327, 사진 4,280 | 2026-02-09 |
| 미슐랭 | 33개 (3스타2, 2스타3, 1스타1) | - |
| 웹 검색 캐시 | 6,703개 | - |
| 경로 캐시 | 199개 | - |
| 환율 | 60개 통화쌍 | 매일 자동 |
| 날씨 | 71개 도시 | 매시간 자동 |

---

## 4. 도시 현황 (71개)

| 분류 | 도시 수 | 시딩 상태 |
|------|---------|----------|
| 프랑스 | 30개 | 파리·니스만 기존 데이터, 28개 대기 |
| 유럽 (프랑스 제외) | 32개 | 대부분 기존 데이터, 시딩 대기 |
| 기타 (아시아/미주) | 9개 | 기존 데이터 |

---

## 5. 참조 문서

| 문서 | 용도 |
|------|------|
| `.cursor/rules/*.mdc` | AI 규칙 9개 (항상 자동 적용) |
| `docs/TASK_ARCHIVE.md` | 완료된 작업 이력 |
| `docs/PRD.md` | 제품 요구사항 (수정 금지) |
| `docs/TRD.md` | 기술 요구사항 (수정 금지) |
| `docs/NUBI_WHITEPAPER.md` | 핵심 알고리즘 백서 (수정 금지) |
| `docs/AGENT_PROTOCOL.md` | 에이전트 통신 규약 |

---

## 변경 이력

| 날짜 | 내용 |
|------|------|
| 2026-02-10 | 문서 체계화: .cursor/rules/ 9개 .mdc + TASK.md 슬림화 + TASK_ARCHIVE.md 분리 |
| 2026-02-10 | API 비용 보호: ag3 Places apiCallTracker + route-optimizer routeCallTracker |
| 2026-02-09 | Pipeline V3 + 교통비 A/B + place-linker + 10개 크롤러 파이프라인 |
| 2026-02-08 | 4+1 에이전트 → Pipeline V3 전환, 71개 도시, place-seeder 최적화 |
| 2026-02-07 | 장소 시딩 시스템, 크롤러 3종 신규, 알고리즘 Phase 1 |
| 2026-02-06 | 관리자 대시보드, Gemini 3.0 통일, Replit 제거 |
